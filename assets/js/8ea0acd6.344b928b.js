"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[3369],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return d}});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=l(t),d=r,f=m["".concat(c,".").concat(d)]||m[d]||u[d]||o;return t?a.createElement(f,i(i({ref:n},p),{},{components:t})):a.createElement(f,i({ref:n},p))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6734:function(e,n,t){t.r(n),t.d(n,{assets:function(){return p},contentTitle:function(){return c},default:function(){return d},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var a=t(3117),r=t(102),o=(t(7294),t(3905)),i=["components"],s={id:"db_namespaces",title:"Database-driven namespace configuration",sidebar_label:"Database-driven namespaces"},c=void 0,l={unversionedId:"pro/db_namespaces",id:"pro/db_namespaces",title:"Database-driven namespace configuration",description:"Centrifugo PRO supports database-driven namespace configuration. This means that instead of configuring namespaces in a configuration file you will be able to configure them in admin web UI. It's also possible to select a namespace for automatic personal channel subscription.",source:"@site/docs/pro/db_namespaces.md",sourceDirName:"pro",slug:"/pro/db_namespaces",permalink:"/docs/pro/db_namespaces",editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/pro/db_namespaces.md",tags:[],version:"current",frontMatter:{id:"db_namespaces",title:"Database-driven namespace configuration",sidebar_label:"Database-driven namespaces"}},p={},u=[{value:"How it works",id:"how-it-works",level:2},{value:"Configuration",id:"configuration",level:2}],m={toc:u};function d(e){var n=e.components,s=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,s,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Centrifugo PRO supports database-driven namespace configuration. This means that instead of configuring namespaces in a configuration file you will be able to configure them in admin web UI. It's also possible to select a namespace for automatic personal channel subscription."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Namespaces",src:t(5256).Z,width:"2564",height:"1412"})),(0,o.kt)("h2",{id:"how-it-works"},"How it works"),(0,o.kt)("p",null,"As soon as you point Centrifugo PRO to an admin storage and enable storage namespace management, Centrifugo will load namespaces from database table on start. Changes made in web UI will then propagate to all running Centrifugo nodes in up to 30 seconds."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Centrifugo nodes cache namespace configuration in memory so if Centrifugo temporarily lost connection to a database it will continue working with previous namespace configuration until connection problems will be resolved."))),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("p",null,"By default namespace database management is off \u2013 i.e. namespaces loaded on Centrifugo start from a configuration file (or environment variable)."),(0,o.kt)("p",null,"To enable namespace management through database add the following into configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "admin_storage": {\n        "enabled": true,\n        "storage_type": "sqlite",\n        "storage_dsn": "/path/to/centrifugo.db",\n        "manage_namespaces": true\n    }\n}\n')),(0,o.kt)("p",null,"Centrifugo PRO supports several SQL database backends to keep namespace information:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"SQLite (storage_type: ",(0,o.kt)("inlineCode",{parentName:"li"},"sqlite"),")"),(0,o.kt)("li",{parentName:"ul"},"PostgreSQL (storage_type: ",(0,o.kt)("inlineCode",{parentName:"li"},"postgresql"),")"),(0,o.kt)("li",{parentName:"ul"},"MySQL (storage_type: ",(0,o.kt)("inlineCode",{parentName:"li"},"mysql"),")")),(0,o.kt)("p",null,"Each storage type has its own ",(0,o.kt)("inlineCode",{parentName:"p"},"storage_dsn")," format. For SQLite it's just a path to a db file."),(0,o.kt)("p",null,"PostgreSQL dsn format described ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/github.com/jackc/pgconn?utm_source=godoc#ParseConfig"},"here"),". Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "admin_storage": {\n        "enabled": true,\n        "storage_type": "postgresql",\n        "storage_dsn": "host=localhost user=postgres password=mysecretpassword dbname=centrifugo port=5432 sslmode=disable",\n        "manage_namespaces": true\n    }\n}\n')),(0,o.kt)("p",null,"MySQL dsn format described ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/go-sql-driver/mysql#dsn-data-source-name"},"here"),". Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "admin_storage": {\n        "enabled": true,\n        "storage_type": "mysql",\n        "storage_dsn": "user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&parseTime=True&loc=Local",\n        "manage_namespaces": true\n    }\n}\n')))}d.isMDXComponent=!0},5256:function(e,n,t){n.Z=t.p+"assets/images/namespaces-4cdd9f366c740c37a12a576576b3dfb4.png"}}]);