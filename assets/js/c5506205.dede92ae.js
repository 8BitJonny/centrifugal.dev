"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[6430],{3905:function(t,e,n){n.d(e,{Zo:function(){return c},kt:function(){return f}});var r=n(7294);function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var s=r.createContext({}),u=function(t){var e=r.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):a(a({},e),t)),n},c=function(t){var e=u(t.components);return r.createElement(s.Provider,{value:e},t.children)},p={inlineCode:"code",wrapper:function(t){var e=t.children;return r.createElement(r.Fragment,{},e)}},d=r.forwardRef((function(t,e){var n=t.components,i=t.mdxType,o=t.originalType,s=t.parentName,c=l(t,["components","mdxType","originalType","parentName"]),d=u(n),f=i,g=d["".concat(s,".").concat(f)]||d[f]||p[f]||o;return n?r.createElement(g,a(a({ref:e},c),{},{components:n})):r.createElement(g,a({ref:e},c))}));function f(t,e){var n=arguments,i=e&&e.mdxType;if("string"==typeof t||i){var o=n.length,a=new Array(o);a[0]=d;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:i,a[1]=l;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6096:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return u},toc:function(){return c},default:function(){return d}});var r=n(2122),i=n(9756),o=(n(7294),n(3905)),a=["components"],l={id:"throttling",title:"Operation throttling"},s=void 0,u={unversionedId:"pro/throttling",id:"pro/throttling",isDocsHomePage:!1,title:"Operation throttling",description:"The throttling feature allows limiting the number of operations each user can issue during a configured time interval. This is useful to protect the system from misusing or protect it from a bug in the application frontend code.",source:"@site/docs/pro/throttling.md",sourceDirName:"pro",slug:"/pro/throttling",permalink:"/docs/pro/throttling",editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/pro/throttling.md",version:"current",frontMatter:{id:"throttling",title:"Operation throttling"},sidebar:"Pro",previous:{title:"User status",permalink:"/docs/pro/user_status"},next:{title:"User connections API",permalink:"/docs/pro/user_connections"}},c=[{value:"Redis throttling",id:"redis-throttling",children:[]}],p={toc:c};function d(t){var e=t.components,n=(0,i.Z)(t,a);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"The throttling feature allows limiting the number of operations each user can issue during a configured time interval. This is useful to protect the system from misusing or protect it from a bug in the application frontend code."),(0,o.kt)("h2",{id:"redis-throttling"},"Redis throttling"),(0,o.kt)("p",null,"At this moment Centrifugo PRO provides throttling over Redis. It's only possible to throttle by the user ID. Requests from anonymous users can't be throttled. Throttling with Redis uses ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Token_bucket"},"token bucket algorithm")," internally."),(0,o.kt)("p",null,"Here is a list of operations that can be throttled:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"connect"),(0,o.kt)("li",{parentName:"ul"},"subscribe"),(0,o.kt)("li",{parentName:"ul"},"publish"),(0,o.kt)("li",{parentName:"ul"},"history"),(0,o.kt)("li",{parentName:"ul"},"presence"),(0,o.kt)("li",{parentName:"ul"},"presence_stats"),(0,o.kt)("li",{parentName:"ul"},"refresh"),(0,o.kt)("li",{parentName:"ul"},"sub_refresh"),(0,o.kt)("li",{parentName:"ul"},"rpc (with method resolution)")),(0,o.kt)("p",null,"An example configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "redis_throttling": {\n        "enabled": false,\n        "redis_address": "localhost:6379",\n        "buckets": {\n            "publish": {\n                "enabled": true,\n                "interval": "1s",\n                "rate": 1,\n                "capacity": 1\n            },\n            "rpc": {\n                "enabled": true,\n                "interval": "1s",\n                "rate": 10,\n                "capacity": 1,\n                "method_override": [\n                    {\n                        "method": "updateActiveStatus",\n                        "interval": "20s",\n                        "rate": 1,\n                        "capacity": 1\n                    }\n                ]\n            }\n        }\n    }\n}\n')),(0,o.kt)("p",null,"This configuration enables throttling and throttles publish attempts in a way that only 1 publication is possible in 1 second from the same user."),(0,o.kt)("p",null,"Redis configuration for throttling feature matches Centrifugo Redis engine configuration. So Centrifugo supports client-side consistent sharding to scale Redis, Redis Sentinel, Redis Cluster for throttling feature too."),(0,o.kt)("p",null,"It's also possible to reuse Centrifugo Redis engine by setting ",(0,o.kt)("inlineCode",{parentName:"p"},"use_redis_from_engine")," option instead of custom throttling Redis address declaration, like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "engine": "redis",\n    "redis_address": "localhost:6379",\n    "redis_throttling": {\n        "enabled": false,\n        "use_redis_from_engine": true,\n        "buckets": {\n            "publish": {\n                "enabled": true,\n                "interval": "1s",\n                "rate": 1,\n                "capacity": 1\n            }\n        }\n    }\n}\n')),(0,o.kt)("p",null,"In this case throttling will simply connect to Redis instances configured for an Engine."))}d.isMDXComponent=!0}}]);