"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[4114],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return c}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),c=r,h=d["".concat(p,".").concat(c)]||d[c]||m[c]||l;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6421:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return u},default:function(){return d}});var a=n(2122),r=n(9756),l=(n(7294),n(3905)),i=["components"],o={id:"server_api",title:"Server API"},p=void 0,s={unversionedId:"server/server_api",id:"server/server_api",isDocsHomePage:!1,title:"Server API",description:"Server API is a way to send various commands to Centrifugo. For example, server API allows publishing messages to channels, get server statistics etc. There are two kinds of API available at the moment:",source:"@site/docs/server/server_api.md",sourceDirName:"server",slug:"/server/server_api",permalink:"/docs/server/server_api",editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/server_api.md",version:"current",frontMatter:{id:"server_api",title:"Server API"},sidebar:"Guides",previous:{title:"Console commands",permalink:"/docs/server/console_commands"},next:{title:"Client authentication",permalink:"/docs/server/authentication"}},u=[{value:"HTTP API",id:"http-api",children:[{value:"HTTP API authorization",id:"http-api-authorization",children:[]},{value:"publish",id:"publish",children:[]},{value:"broadcast",id:"broadcast",children:[]},{value:"subscribe",id:"subscribe",children:[]},{value:"unsubscribe",id:"unsubscribe",children:[]},{value:"disconnect",id:"disconnect",children:[]},{value:"presence",id:"presence",children:[]},{value:"presence_stats",id:"presence_stats",children:[]},{value:"history",id:"history",children:[]},{value:"rpc",id:"rpc",children:[]},{value:"info",id:"info",children:[]},{value:"Command pipelining",id:"command-pipelining",children:[]}]},{value:"GRPC API",id:"grpc-api",children:[{value:"GRPC example for Python",id:"grpc-example-for-python",children:[]},{value:"GRPC example for Go",id:"grpc-example-for-go",children:[]},{value:"GRPC API key authorization",id:"grpc-api-key-authorization",children:[]}]}],m={toc:u};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Server API is a way to send various commands to Centrifugo. For example, server API allows publishing messages to channels, get server statistics etc. There are two kinds of API available at the moment:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"HTTP API"),(0,l.kt)("li",{parentName:"ul"},"GRPC API")),(0,l.kt)("h2",{id:"http-api"},"HTTP API"),(0,l.kt)("p",null,"Server HTTP API works on ",(0,l.kt)("inlineCode",{parentName:"p"},"/api")," endpoint (by default). It has a simple request format: this is a HTTP POST request with ",(0,l.kt)("inlineCode",{parentName:"p"},"application/json")," Content-Type and with JSON command body."),(0,l.kt)("p",null,"Here we will look at available methods and parameters"),(0,l.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"In some cases you can just use one of our ",(0,l.kt)("a",{parentName:"p",href:"/docs/ecosystem/api"},"available HTTP API libraries")," or use Centrifugo ",(0,l.kt)("a",{parentName:"p",href:"#grpc-api"},"GRPC API")," to avoid manually constructing requests."))),(0,l.kt)("h3",{id:"http-api-authorization"},"HTTP API authorization"),(0,l.kt)("p",null,"HTTP API protected by ",(0,l.kt)("inlineCode",{parentName:"p"},"api_key")," set in Centrifugo configuration. I.e. ",(0,l.kt)("inlineCode",{parentName:"p"},"api_key")," option must be added to config, like:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "api_key": "<YOUR API KEY>"\n}\n')),(0,l.kt)("p",null,"This API key must be set in request ",(0,l.kt)("inlineCode",{parentName:"p"},"Authorization")," header in this way:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Authorization: apikey <KEY>\n")),(0,l.kt)("p",null,"It's also possible to pass API key over URL query param. This solves some edge cases where it's not possible to use ",(0,l.kt)("inlineCode",{parentName:"p"},"Authorization")," header. Simply add ",(0,l.kt)("inlineCode",{parentName:"p"},"?api_key=<YOUR API KEY>")," query param to API endpoint. Keep in mind that passing API key in ",(0,l.kt)("inlineCode",{parentName:"p"},"Authorization")," header is a recommended way. "),(0,l.kt)("p",null,"It's possible to disable API key check on Centrifugo side using ",(0,l.kt)("inlineCode",{parentName:"p"},"api_insecure")," configuration option. Be sure to protect API endpoint by firewall rules in this case to prevent anyone in internet to send commands over your unprotected Centrifugo API endpoint. API key auth is not very safe for man-in-the-middle so we also recommended running Centrifugo with TLS."),(0,l.kt)("p",null,"Command is a JSON object with two properties: ",(0,l.kt)("inlineCode",{parentName:"p"},"method")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"params"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"method")," is a name of API command you want to call."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"params")," is an object with command arguments. Each ",(0,l.kt)("inlineCode",{parentName:"li"},"method")," can have its own ",(0,l.kt)("inlineCode",{parentName:"li"},"params"))),(0,l.kt)("p",null,"Before looking at all available commands here is a CURL that calls ",(0,l.kt)("inlineCode",{parentName:"p"},"info")," command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'curl --header "Authorization: apikey <API_KEY>" \\\n  --request POST \\\n  --data \'{"method": "info", "params": {}\' \\\n  http://localhost:8000/api\n')),(0,l.kt)("p",null,"Here is a live example:"),(0,l.kt)("iframe",{width:"100%",height:"400",src:"/img/api_example.mp4",frameborder:"0",allow:"accelerometer; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}),(0,l.kt)("p",null,"Now let's investigate each API methods in detail."),(0,l.kt)("h3",{id:"publish"},"publish"),(0,l.kt)("p",null,"Publish command allows publishing data into a channel. Most probably this is a command you'll use most."),(0,l.kt)("p",null,"It looks like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "publish",\n    "params": {\n        "channel": "chat", \n        "data": {\n            "text": "hello"\n        }\n    } \n}\n')),(0,l.kt)("p",null,"Let's apply all information said above and send publish command to Centrifugo. We will send request using ",(0,l.kt)("inlineCode",{parentName:"p"},"requests")," library for Python. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'import json\nimport requests\n\ncommand = {\n    "method": "publish",\n    "params": {\n        "channel": "docs", \n        "data": {\n            "content": "1"\n        }\n    }\n}\n\napi_key = "YOUR_API_KEY"\ndata = json.dumps(command)\nheaders = {\'Content-type\': \'application/json\', \'Authorization\': \'apikey \' + api_key}\nresp = requests.post("https://centrifuge.example.com/api", data=data, headers=headers)\nprint(resp.json())\n')),(0,l.kt)("p",null,"The same using ",(0,l.kt)("inlineCode",{parentName:"p"},"httpie")," console tool:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "publish", "params": {"channel": "chat", "data": {"text": "hello"}}}\' | http "localhost:8000/api" Authorization:"apikey <YOUR_API_KEY>" -vvv\nPOST /api HTTP/1.1\nAccept: application/json, */*\nAccept-Encoding: gzip, deflate\nAuthorization: apikey KEY\nConnection: keep-alive\nContent-Length: 80\nContent-Type: application/json\nHost: localhost:8000\nUser-Agent: HTTPie/0.9.8\n\n{\n    "method": "publish",\n    "params": {\n        "channel": "chat",\n        "data": {\n            "text": "hello"\n        }\n    }\n}\n\nHTTP/1.1 200 OK\nContent-Length: 3\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:01:42 GMT\n\n{\n    "result": {}\n}\n')),(0,l.kt)("p",null,"In case of error response object can contain ",(0,l.kt)("inlineCode",{parentName:"p"},"error")," field (here we artificially publishing to a channel with unknown namespace):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "publish", "params": {"channel": "unknown:chat", "data": {"text": "hello"}}}\' | http "localhost:8000/api" Authorization:"apikey <YOUR_API_KEY>"\nHTTP/1.1 200 OK\nContent-Length: 55\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:03:09 GMT\n\n{\n    "error": {\n        "code": 102,\n        "message": "namespace not found"\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"error")," object contains error code and message - this also the same for other commands described below."),(0,l.kt)("h4",{id:"publish-params"},"Publish params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to publish")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON object"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Custom JSON data to publish into a channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"skip_history"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Skip adding publication to history for this request")))),(0,l.kt)("h4",{id:"publish-result"},"Publish result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"offset"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Offset of publication in history stream")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"epoch"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Epoch of current stream")))),(0,l.kt)("h3",{id:"broadcast"},"broadcast"),(0,l.kt)("p",null,"Similar to ",(0,l.kt)("inlineCode",{parentName:"p"},"publish")," but allows to send the same data into many channels."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "broadcast",\n    "params": {\n        "channels": ["CHANNEL_1", "CHANNEL_2"],\n        "data": {\n            "text": "hello"\n        }\n    }\n}\n')),(0,l.kt)("h4",{id:"broadcast-params"},"Broadcast params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channels"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of strings"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"List of channels to publish data to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON object"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Custom JSON data to publish into each channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"skip_history"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Skip adding publications to channels' history for this request")))),(0,l.kt)("h4",{id:"broadcast-result"},"Broadcast result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"responses"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of publish responses"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Responses for each individual publish (with possible error and publish result)")))),(0,l.kt)("h3",{id:"subscribe"},"subscribe"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"subscribe")," allows subscribing user to a channel."),(0,l.kt)("h4",{id:"subscribe-params"},"Subscribe params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to subscribe")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to subscribe user to")))),(0,l.kt)("h4",{id:"subscribe-result"},"Subscribe result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"unsubscribe"},"unsubscribe"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"unsubscribe")," allows unsubscribing user from a channel."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "unsubscribe",\n    "params": {\n        "channel": "CHANNEL NAME",\n        "user": "USER ID"\n    }\n}\n')),(0,l.kt)("h4",{id:"unsubscribe-params"},"Unsubscribe params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to subscribe")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to subscribe user to")))),(0,l.kt)("h4",{id:"unsubscribe-result"},"Unsubscribe result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"disconnect"},"disconnect"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"disconnect")," allows disconnecting user by ID."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "disconnect",\n    "params": {\n        "user": "USER ID"\n    }\n}\n')),(0,l.kt)("h4",{id:"disconnect-params"},"Disconnect params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to subscribe")))),(0,l.kt)("h4",{id:"disconnect-result"},"Disconnect result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"presence"},"presence"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"presence")," allows getting channel presence information (all clients currently subscribed on this channel)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "presence",\n    "params": {\n        "channel": "chat"\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'fz@centrifugo: echo \'{"method": "presence", "params": {"channel": "chat"}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 127\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:13:17 GMT\n\n{\n    "result": {\n        "presence": {\n            "c54313b2-0442-499a-a70c-051f8588020f": {\n                "client": "c54313b2-0442-499a-a70c-051f8588020f",\n                "user": "42"\n            },\n            "adad13b1-0442-499a-a70c-051f858802da": {\n                "client": "adad13b1-0442-499a-a70c-051f858802da",\n                "user": "42"\n            }\n        }\n    }\n}\n')),(0,l.kt)("h4",{id:"presence-params"},"Presence params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to call presence from")))),(0,l.kt)("h4",{id:"presence-result"},"Presence result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"presence"),(0,l.kt)("td",{parentName:"tr",align:null},"Map of client ID (string) to client info"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Offset of publication in history stream")))),(0,l.kt)("h3",{id:"presence_stats"},"presence_stats"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"presence_stats")," allows getting short channel presence information."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "presence_stats",\n    "params": {\n        "channel": "chat"\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "presence_stats", "params": {"channel": "public:chat"}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 43\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:09:44 GMT\n\n{\n    "result": {\n        "num_clients": 0,\n        "num_users": 0\n    }\n}\n')),(0,l.kt)("h4",{id:"presence-stats-params"},"Presence stats params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to call presence from")))),(0,l.kt)("h4",{id:"presence-stats-result"},"Presence stats result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"num_clients"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Total number of clients in channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"num_users"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Total number of unique users in channel")))),(0,l.kt)("h3",{id:"history"},"history"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"history")," allows getting channel history information (list of last messages published into channel)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "history",\n    "params": {\n        "channel": "chat",\n        "limit": 1\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "history", "params": {"channel": "chat", "limit": 2}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 129\nContent-Type: application/json\nDate: Wed, 21 Jul 2021 05:30:48 GMT\n\n{\n    "result": {\n        "epoch": "qFhv",\n        "offset": 4,\n        "publications": [\n            {\n                "data": {\n                    "text": "hello"\n                },\n                "offset": 2\n            },\n            {\n                "data": {\n                    "text": "hello"\n                },\n                "offset": 3\n            }\n        ]\n    }\n}\n')),(0,l.kt)("h4",{id:"history-params"},"History params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to call history from")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"limit"),(0,l.kt)("td",{parentName:"tr",align:null},"int"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Limit number of returned publications")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"since"),(0,l.kt)("td",{parentName:"tr",align:null},"Stream position object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"To return publications after this position")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"reverse"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Iterate in reversed order (from latest to earliest)")))),(0,l.kt)("h4",{id:"history-result"},"History result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"publications"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of publication objects"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"List of publications in channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"offset"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Top offset in history stream")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"epoch"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Epoch of current stream")))),(0,l.kt)("h3",{id:"rpc"},"rpc"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"rpc")," allows calling JSON RPC extension by name. Actually it's RPC inside RPC :)"),(0,l.kt)("h4",{id:"rpc-params"},"RPC params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"method"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"RPC extension method")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"params"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON object"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"RPC extension method params")))),(0,l.kt)("h4",{id:"rpc-result"},"RPC result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Data returned from RPC ",(0,l.kt)("br",null),"(different format for different RPC extensions)")))),(0,l.kt)("p",null,"One available RPC extension is ",(0,l.kt)("inlineCode",{parentName:"p"},"getChannels")," method which returns all active channels in Centrifugo with number of clients in each (optionally filtered by pattern), command looks like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "rpc",\n    "params": {\n        "method": "getChannels",\n        "params": {\n            "pattern": "chat*"\n        }\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Keep in mind that since ",(0,l.kt)("inlineCode",{parentName:"strong"},"getChannels")," RPC extension returns all active channels it can be really heavy for massive deployments.")," There is no way to paginate over channels list and we don't know a case where this could be useful and not error prone. At the moment ",(0,l.kt)("strong",{parentName:"p"},"we mostly suppose that getChannels RPC extension will be used in development process and in not very massive Centrifugo setups")," (with no more than 10k channels). A better and scalable approach could be real-time analytics approach ",(0,l.kt)("a",{parentName:"p",href:"/docs/pro/overview"},"described here"),"."),(0,l.kt)("h3",{id:"info"},"info"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"info")," method allows getting information about running Centrifugo nodes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "info", "params": {}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 184\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:07:58 GMT\n\n{\n    "result": {\n        "nodes": [\n            {\n                "name": "Alexanders-MacBook-Pro.local_8000",\n                "num_channels": 0,\n                "num_clients": 0,\n                "num_users": 0,\n                "uid": "f844a2ed-5edf-4815-b83c-271974003db9",\n                "uptime": 0,\n                "version": ""\n            }\n        ]\n    }\n}\n')),(0,l.kt)("h4",{id:"info-params"},"Info params"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h4",{id:"info-result"},"Info result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Result field"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Can be omitted"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"nodes"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of Node objects"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Information about all nodes in a cluster")))),(0,l.kt)("h3",{id:"command-pipelining"},"Command pipelining"),(0,l.kt)("p",null,"It's possible to combine several commands into one request to Centrifugo. To do this use ",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/JSON_streaming"},"JSON streaming")," format. This can improve server throughput and reduce traffic travelling around."),(0,l.kt)("h2",{id:"grpc-api"},"GRPC API"),(0,l.kt)("p",null,"Centrifugo also supports ",(0,l.kt)("a",{parentName:"p",href:"https://grpc.io/"},"GRPC")," API. With GRPC it's possible to communicate with Centrifugo using more compact binary representation of commands and use the power of HTTP/2 which is the transport behind GRPC."),(0,l.kt)("p",null,"GRPC API is also useful if you want to publish binary data to Centrifugo channels."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"GRPC API basically allows calling all commands described in ",(0,l.kt)("a",{parentName:"p",href:"#http-api"},"HTTP API doc"),", actually both GRPC and HTTP API in Centrifugo based on the same Protobuf schema definition. So refer to the HTTP API description doc for parameter and result field description."))),(0,l.kt)("p",null,"You can enable GRPC API in Centrifugo using ",(0,l.kt)("inlineCode",{parentName:"p"},"grpc_api")," option:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "grpc_api": true\n}\n')),(0,l.kt)("p",null,"By default, GRPC will be served on port ",(0,l.kt)("inlineCode",{parentName:"p"},"10000")," but you can change it using ",(0,l.kt)("inlineCode",{parentName:"p"},"grpc_api_port")," option."),(0,l.kt)("p",null,"Now as soon as Centrifugo started you can send GRPC commands to it. To do this get our API Protocol Buffer definitions ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/master/misc/proto/api.proto"},"from this file"),"."),(0,l.kt)("p",null,"Then see ",(0,l.kt)("a",{parentName:"p",href:"https://grpc.io/docs/"},"GRPC docs specific to your language")," to find out how to generate client code from definitions and use generated code to communicate with Centrifugo."),(0,l.kt)("h3",{id:"grpc-example-for-python"},"GRPC example for Python"),(0,l.kt)("p",null,"For example for Python you need to run sth like this according to GRPC docs:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"python -m grpc_tools.protoc -I../../protos --python_out=. --grpc_python_out=. api.proto\n")),(0,l.kt)("p",null,"As soon as you run command you will have 2 generated files: ",(0,l.kt)("inlineCode",{parentName:"p"},"api_pb2.py")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"api_pb2_grpc.py"),". Now all you need is to write simple program that uses generated code and sends GRPC requests to Centrifugo:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"import grpc\nimport api_pb2_grpc as api_grpc\nimport api_pb2 as api_pb\n\nchannel = grpc.insecure_channel('localhost:10000')\nstub = api_grpc.CentrifugoStub(channel)\n\ntry:\n    resp = stub.Info(api_pb.InfoRequest())\nexcept grpc.RpcError as err:\n    # GRPC level error.\n    print(err.code(), err.details())\nelse:\n    if resp.error.code:\n        # Centrifugo server level error.\n        print(resp.error.code, resp.error.message)\n    else:\n        print(resp.result)\n")),(0,l.kt)("p",null,"Note that you need to explicitly handle Centrifugo API level error which is not transformed automatically into GRPC protocol level error."),(0,l.kt)("h3",{id:"grpc-example-for-go"},"GRPC example for Go"),(0,l.kt)("p",null,"Here is a simple example on how to run Centrifugo with GRPC Go client."),(0,l.kt)("p",null,"You need ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc-gen-go")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc-gen-go-grpc")," installed."),(0,l.kt)("p",null,"First start Centrifugo itself with GRPC API enabled:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"CENTRIFUGO_GRPC_API=1 centrifugo --config config.json\n")),(0,l.kt)("p",null,"In another terminal tab:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir centrifugo_grpc_example\ncd centrifugo_grpc_example/\ntouch main.go\ngo mod init centrifugo_example\nmkdir apiproto\ncd apiproto\nwget https://raw.githubusercontent.com/centrifugal/centrifugo/master/misc/proto/api.proto -O api.proto\n")),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc")," to generate code:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"protoc -I ./ api.proto --go_out=. --go-grpc_out=.\n")),(0,l.kt)("p",null,"Put the following code to ",(0,l.kt)("inlineCode",{parentName:"p"},"main.go")," file (created on last step above):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "context"\n    "log"\n    "time"\n\n    "centrifugo_example/apiproto"\n\n    "google.golang.org/grpc"\n)\n\nfunc main() {\n    conn, err := grpc.Dial("localhost:10000", grpc.WithInsecure())\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer conn.Close()\n    client := apiproto.NewCentrifugoClient(conn)\n    for {\n        resp, err := client.Publish(context.Background(), &PublishRequest{\n            Channel: "chat:index",\n            Data:    []byte(`{"input": "hello from GRPC"}`),\n        })\n        if err != nil {\n            log.Printf("Transport level error: %v", err)\n        } else {\n            if resp.GetError() != nil {\n                respError := resp.GetError()\n                log.Printf("Error %d (%s)", respError.Code, respError.Message)\n            } else {\n                log.Println("Successfully published")\n            }\n        }\n        time.Sleep(time.Second)\n    }\n}\n')),(0,l.kt)("p",null,"Then run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"go run main.go\n")),(0,l.kt)("p",null,"The program starts and periodically publishes the same payload into ",(0,l.kt)("inlineCode",{parentName:"p"},"chat:index")," channel."),(0,l.kt)("h3",{id:"grpc-api-key-authorization"},"GRPC API key authorization"),(0,l.kt)("p",null,"You can also set ",(0,l.kt)("inlineCode",{parentName:"p"},"grpc_api_key")," (string) in Centrifugo configuration to protect GRPC API with key. In this case you should set per RPC metadata with key ",(0,l.kt)("inlineCode",{parentName:"p"},"authorization")," and value ",(0,l.kt)("inlineCode",{parentName:"p"},"apikey <KEY>"),". For example in Go language:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "context"\n    "log"\n    "time"\n\n    "centrifugo_example/apiproto"\n    \n    "google.golang.org/grpc"\n)\n\ntype keyAuth struct {\n    key string\n}\n\nfunc (t keyAuth) GetRequestMetadata(ctx context.Context, uri ...string) (map[string]string, error) {\n    return map[string]string{\n        "authorization": "apikey " + t.key,\n    }, nil\n}\n\nfunc (t keyAuth) RequireTransportSecurity() bool {\n    return false\n}\n\nfunc main() {\n    conn, err := grpc.Dial("localhost:10000", grpc.WithInsecure(), grpc.WithPerRPCCredentials(keyAuth{"xxx"}))\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer conn.Close()\n    client := apiproto.NewCentrifugoClient(conn)\n    for {\n        resp, err := client.Publish(context.Background(), &PublishRequest{\n            Channel: "chat:index",\n            Data:    []byte(`{"input": "hello from GRPC"}`),\n        })\n        if err != nil {\n            log.Printf("Transport level error: %v", err)\n        } else {\n            if resp.GetError() != nil {\n                respError := resp.GetError()\n                log.Printf("Error %d (%s)", respError.Code, respError.Message)\n            } else {\n                log.Println("Successfully published")\n            }\n        }\n        time.Sleep(time.Second)\n    }\n}\n')),(0,l.kt)("p",null,"For other languages refer to GRPC docs."))}d.isMDXComponent=!0}}]);