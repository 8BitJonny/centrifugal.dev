"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[8896],{3905:function(e,n,i){i.d(n,{Zo:function(){return p},kt:function(){return d}});var t=i(7294);function a(e,n,i){return n in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function o(e,n){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),i.push.apply(i,t)}return i}function s(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?o(Object(i),!0).forEach((function(n){a(e,n,i[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(i,n))}))}return e}function l(e,n){if(null==e)return{};var i,t,a=function(e,n){if(null==e)return{};var i,t,a={},o=Object.keys(e);for(t=0;t<o.length;t++)i=o[t],n.indexOf(i)>=0||(a[i]=e[i]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(t=0;t<o.length;t++)i=o[t],n.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var r=t.createContext({}),c=function(e){var n=t.useContext(r),i=n;return e&&(i="function"==typeof e?e(n):s(s({},n),e)),i},p=function(e){var n=c(e.components);return t.createElement(r.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},h=t.forwardRef((function(e,n){var i=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(i),d=a,m=h["".concat(r,".").concat(d)]||h[d]||u[d]||o;return i?t.createElement(m,s(s({ref:n},p),{},{components:i})):t.createElement(m,s({ref:n},p))}));function d(e,n){var i=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=i.length,s=new Array(o);s[0]=h;var l={};for(var r in n)hasOwnProperty.call(n,r)&&(l[r]=n[r]);l.originalType=e,l.mdxType="string"==typeof e?e:a,s[1]=l;for(var c=2;c<o;c++)s[c]=i[c];return t.createElement.apply(null,s)}return t.createElement.apply(null,i)}h.displayName="MDXCreateElement"},4731:function(e,n,i){i.r(n),i.d(n,{assets:function(){return p},contentTitle:function(){return r},default:function(){return d},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var t=i(3117),a=i(102),o=(i(7294),i(3905)),s=["components"],l={id:"channels",title:"Channels"},r=void 0,c={unversionedId:"server/channels",id:"server/channels",title:"Channels",description:"One of the core concepts of Centrifugo is a channel. Most of the time you will work with them and decide what is the best channel configuration for your application.",source:"@site/docs/server/channels.md",sourceDirName:"server",slug:"/server/channels",permalink:"/docs/next/server/channels",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/channels.md",tags:[],version:"current",frontMatter:{id:"channels",title:"Channels"},sidebar:"Guides",previous:{title:"Client authentication",permalink:"/docs/next/server/authentication"},next:{title:"Private channels",permalink:"/docs/next/server/private_channels"}},p={},u=[{value:"What is channel",id:"what-is-channel",level:2},{value:"Channel name rules",id:"channel-name-rules",level:2},{value:"namespace boundary (<code>:</code>)",id:"namespace-boundary-",level:3},{value:"user channel boundary (<code>#</code>)",id:"user-channel-boundary-",level:3},{value:"private channel prefix (<code>$</code>)",id:"private-channel-prefix-",level:3},{value:"Channel options",id:"channel-options",level:2},{value:"presence",id:"presence",level:3},{value:"join_leave",id:"join_leave",level:3},{value:"history_size",id:"history_size",level:3},{value:"history_ttl",id:"history_ttl",level:3},{value:"force_positioning",id:"force_positioning",level:3},{value:"force_recovery",id:"force_recovery",level:3},{value:"enable_user_limited_channels",id:"enable_user_limited_channels",level:3},{value:"allow_subscribe_for_client",id:"allow_subscribe_for_client",level:3},{value:"allow_anonymous_access",id:"allow_anonymous_access",level:3},{value:"allow_publish_for_subscriber",id:"allow_publish_for_subscriber",level:3},{value:"allow_publish_for_client",id:"allow_publish_for_client",level:3},{value:"allow_history_for_subscriber",id:"allow_history_for_subscriber",level:3},{value:"allow_history_for_client",id:"allow_history_for_client",level:3},{value:"allow_presence_for_subscriber",id:"allow_presence_for_subscriber",level:3},{value:"allow_presence_for_client",id:"allow_presence_for_client",level:3},{value:"proxy_subscribe",id:"proxy_subscribe",level:3},{value:"proxy_publish",id:"proxy_publish",level:3},{value:"subscribe_proxy_name",id:"subscribe_proxy_name",level:3},{value:"publish_proxy_name",id:"publish_proxy_name",level:3},{value:"Config example",id:"config-example",level:3},{value:"Channel namespaces",id:"channel-namespaces",level:2},{value:"Channel permissions for server API",id:"channel-permissions-for-server-api",level:2},{value:"Channel permissions for client API",id:"channel-permissions-for-client-api",level:2},{value:"Subscribe permission model",id:"subscribe-permission-model",level:3},{value:"Provide subscription token",id:"provide-subscription-token",level:4},{value:"Configure subscribe proxy",id:"configure-subscribe-proxy",level:4},{value:"Use user-limited channels",id:"use-user-limited-channels",level:4},{value:"Subscribe capabilities in connection token",id:"subscribe-capabilities-in-connection-token",level:4},{value:"Subscribe capabilities in connect proxy",id:"subscribe-capabilities-in-connect-proxy",level:4},{value:"Use subscribe CEL expression",id:"use-subscribe-cel-expression",level:4},{value:"Use subscribe_allowed_for_client namespace option",id:"use-subscribe_allowed_for_client-namespace-option",level:4},{value:"Publish permission model",id:"publish-permission-model",level:3},{value:"Publish capabilities in connection token",id:"publish-capabilities-in-connection-token",level:4},{value:"Publish capability in subscription token",id:"publish-capability-in-subscription-token",level:4},{value:"Publish capabilities in connect proxy",id:"publish-capabilities-in-connect-proxy",level:4},{value:"Publish capability in subscribe proxy",id:"publish-capability-in-subscribe-proxy",level:4},{value:"Use publish_allowed_for_client namespace option",id:"use-publish_allowed_for_client-namespace-option",level:4},{value:"Use publish_allowed_for_subscriber namespace option",id:"use-publish_allowed_for_subscriber-namespace-option",level:4},{value:"Configure publish proxy",id:"configure-publish-proxy",level:4},{value:"History permission model",id:"history-permission-model",level:3},{value:"Use history_allowed_for_client namespace option",id:"use-history_allowed_for_client-namespace-option",level:4},{value:"Use history_allowed_for_subscriber namespace option",id:"use-history_allowed_for_subscriber-namespace-option",level:4},{value:"History capabilities in connection token",id:"history-capabilities-in-connection-token",level:4},{value:"History capabilities in subscription token",id:"history-capabilities-in-subscription-token",level:4},{value:"History capabilities in connect proxy",id:"history-capabilities-in-connect-proxy",level:4},{value:"History capability in subscribe proxy response",id:"history-capability-in-subscribe-proxy-response",level:4},{value:"Presence permission model",id:"presence-permission-model",level:3},{value:"Presence capabilities in connection token",id:"presence-capabilities-in-connection-token",level:4},{value:"Presence capabilities in subscription token",id:"presence-capabilities-in-subscription-token",level:4},{value:"Presence capabilities in connect proxy",id:"presence-capabilities-in-connect-proxy",level:4},{value:"Presence capability in subscribe proxy response",id:"presence-capability-in-subscribe-proxy-response",level:4},{value:"Use presence_allowed_for_client namespace option",id:"use-presence_allowed_for_client-namespace-option",level:4},{value:"Use presence_allowed_for_subscriber namespace option",id:"use-presence_allowed_for_subscriber-namespace-option",level:4},{value:"Positioning permission model",id:"positioning-permission-model",level:3},{value:"Recovery permission model",id:"recovery-permission-model",level:3}],h={toc:u};function d(e){var n=e.components,i=(0,a.Z)(e,s);return(0,o.kt)("wrapper",(0,t.Z)({},h,i,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"One of the core concepts of Centrifugo is a ",(0,o.kt)("inlineCode",{parentName:"p"},"channel"),". Most of the time you will work with them and decide what is the best channel configuration for your application."),(0,o.kt)("h2",{id:"what-is-channel"},"What is channel"),(0,o.kt)("p",null,"Channel is a route for publications. Clients can subscribe to a channel to receive real-time messages published to a channel \u2013 new publications and join/leave events. In other PUB/SUB systems similar concept can be called a ",(0,o.kt)("inlineCode",{parentName:"p"},"topic"),". A channel subscriber can also ask for a channel presence or channel history information."),(0,o.kt)("p",null,"Channel is just a string - ",(0,o.kt)("inlineCode",{parentName:"p"},"news"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"comments"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"personal_feed")," are valid channel names. Though this string has some ",(0,o.kt)("a",{parentName:"p",href:"#channel-name-rules"},"predefined rules")," as we will see below. You can define different channel behavior using a set of available ",(0,o.kt)("a",{parentName:"p",href:"#channel-options"},"channel options"),"."),(0,o.kt)("p",null,"Channels are ephemeral \u2013 you don't need to create them explicitly. Channels created automatically by Centrifugo as soon as the first client subscribes to a channel. As soon as the last subscriber leaves a channel - it's automatically cleaned up."),(0,o.kt)("p",null,"Channel can belong to a channel namespace. ",(0,o.kt)("a",{parentName:"p",href:"#channel-namespaces"},"Channel namespacing")," is a mechanism to define different behavior for different channels in Centrifugo. Using namespaces is a recommended way to manage channels \u2013 to turn on only those channel options which are required for a specific real-time feature you are implementing on top of Centrifugo."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"When using channel namespaces make sure you defined a namespace in configuration. Subscription attempts to a channel within a non-defined namespace will result into ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/codes#unknown-channel"},"102: unknown channel")," errors."))),(0,o.kt)("h2",{id:"channel-name-rules"},"Channel name rules"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Only ASCII symbols must be used in a channel string"),"."),(0,o.kt)("p",null,"Channel name length limited by ",(0,o.kt)("inlineCode",{parentName:"p"},"255")," characters by default (can be changed via configuration file option ",(0,o.kt)("inlineCode",{parentName:"p"},"channel_max_length"),")."),(0,o.kt)("p",null,"Several symbols in channel names reserved for Centrifugo internal needs:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},":")," \u2013 for namespace channel boundary (see below)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"$")," \u2013 for private channel prefix (see below)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"#")," \u2013 for user channel boundary (see below)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"*")," \u2013 for the future Centrifugo needs"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"&")," \u2013 for the future Centrifugo needs"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/")," \u2013 for the future Centrifugo needs")),(0,o.kt)("h3",{id:"namespace-boundary-"},"namespace boundary (",(0,o.kt)("inlineCode",{parentName:"h3"},":"),")"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},":")," \u2013 is a channel namespace boundary. Namespaces are used to set custom options to a group of channels. Each channel belonging to the same namespace will have the same channel options. Read more about available ",(0,o.kt)("a",{parentName:"p",href:"#channel-options"},"channel options")," and more about ",(0,o.kt)("a",{parentName:"p",href:"#channel-namespaces"},"namespaces")," below."),(0,o.kt)("p",null,"If the channel is ",(0,o.kt)("inlineCode",{parentName:"p"},"public:chat")," - then Centrifugo will apply options to this channel from the channel namespace with the name ",(0,o.kt)("inlineCode",{parentName:"p"},"public"),"."),(0,o.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"A namespace is part of the channel name. If a user subscribed to a channel with namespace, like ",(0,o.kt)("inlineCode",{parentName:"p"},"public:chat")," \u2013 then you need to publish messages into ",(0,o.kt)("inlineCode",{parentName:"p"},"public:chat")," channel to be delivered to the user. We often see some confusion from developers trying to publish messages into ",(0,o.kt)("inlineCode",{parentName:"p"},"chat")," and thinking that namespace is somehow stripped upon subscription. It's not true."))),(0,o.kt)("h3",{id:"user-channel-boundary-"},"user channel boundary (",(0,o.kt)("inlineCode",{parentName:"h3"},"#"),")"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"#")," \u2013 is a user channel boundary. This is a separator to create personal channels for users (we call this ",(0,o.kt)("em",{parentName:"p"},"user-limited channels"),") without the need to provide a subscription token."),(0,o.kt)("p",null,"For example, if the channel is ",(0,o.kt)("inlineCode",{parentName:"p"},"news#42")," then the only user with ID ",(0,o.kt)("inlineCode",{parentName:"p"},"42")," can subscribe to this channel (Centrifugo knows user ID because clients provide it in connection credentials with connection JWT)."),(0,o.kt)("p",null,"If you want to create a user-limited channel in namespace ",(0,o.kt)("inlineCode",{parentName:"p"},"personal")," then you can use a name like ",(0,o.kt)("inlineCode",{parentName:"p"},"personal:user#42")," for example."),(0,o.kt)("p",null,"Moreover, you can provide several user IDs in channel name separated by a comma: ",(0,o.kt)("inlineCode",{parentName:"p"},"dialog#42,43")," \u2013 in this case only the user with ID ",(0,o.kt)("inlineCode",{parentName:"p"},"42")," and user with ID ",(0,o.kt)("inlineCode",{parentName:"p"},"43")," will be able to subscribe on this channel."),(0,o.kt)("p",null,"This is useful for channels with a static list of allowed users, for example for single user personal messages channel, for dialog channel between certainly defined users. As soon as you need to manage access to a channel dynamically for many users this channel type does not suit well."),(0,o.kt)("p",null,"User-limited channels must be enabled for a channel namespace using ",(0,o.kt)("inlineCode",{parentName:"p"},"enable_user_limit_channels")," option. See below more information about channel options and channel namespaces. "),(0,o.kt)("h3",{id:"private-channel-prefix-"},"private channel prefix (",(0,o.kt)("inlineCode",{parentName:"h3"},"$"),")"),(0,o.kt)("p",null,"Centrifugo v4 has this option to achieve compatibility with previous Centrifugo versions. Previously (in Centrifugo v1, v2 and v3) only channels starting with ",(0,o.kt)("inlineCode",{parentName:"p"},"$")," could be subscribed using a subscription token. In Centrifugo v4 that's not the case anymore \u2013 clients can subscribe to any channel with a subscription token (and if the token is valid \u2013 then subscription is accepted)."),(0,o.kt)("p",null,"But for namespaces with ",(0,o.kt)("inlineCode",{parentName:"p"},"allow_subscribe_for_client")," option enabled Centrifugo does not allow subscribing on channels starting with ",(0,o.kt)("inlineCode",{parentName:"p"},"private_channel_prefix")," (",(0,o.kt)("inlineCode",{parentName:"p"},"$")," by default) without a subscription token. This limitation exists to help users migrate to Centrifugo v4 without security risks. You can disable this limitation by setting ",(0,o.kt)("inlineCode",{parentName:"p"},"private_channel_prefix")," option to ",(0,o.kt)("inlineCode",{parentName:"p"},'""')," (empty string)."),(0,o.kt)("h2",{id:"channel-options"},"Channel options"),(0,o.kt)("p",null,"Channel behavior can be modified by using channel options. Channel options can be defined on configuration top-level and for every namespace."),(0,o.kt)("h3",{id:"presence"},"presence"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"presence")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 enable/disable online presence information for channels in a namespace. "),(0,o.kt)("p",null,"Online presence is information about clients currently subscribed to the channel. It contains each subscriber's client ID, user ID, connection info, and channel info. By default, this option is off so no presence information will be available for channels."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Enabling channel online presence adds some overhead since Centrifugo needs to maintain an additional data structure (in a process memory or in a broker memory/disk). So only use it for channels where presence is required."))),(0,o.kt)("h3",{id:"join_leave"},"join_leave"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"join_leave")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 enable/disable sending join and leave messages when the client subscribes to a channel (unsubscribes from a channel). Join/leave event includes information about the connection that triggered an event \u2013 client ID, user ID, connection info, and channel info (similar to entry inside presence information)."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},'Keep in mind that join/leave messages can generate a huge number of messages in a system if turned on for channels with a large number of active subscribers. If you have channels with a large number of subscribers consider avoiding using this feature. It\'s hard to say what is "large" for you though \u2013 just estimate the load based on the fact that each subscribe/unsubscribe event in a channel with N subscribers will result into N messages broadcasted to all. If all clients reconnect at the same time the amount of generated messages is N^2.'))),(0,o.kt)("h3",{id:"history_size"},"history_size"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"history_size")," (integer, default ",(0,o.kt)("inlineCode",{parentName:"p"},"0"),") \u2013 history size (amount of messages) for channels. As Centrifugo keeps all history messages in process memory (or in a broker memory) it's very important to limit the maximum amount of messages in channel history with a reasonable value. ",(0,o.kt)("inlineCode",{parentName:"p"},"history_size")," defines the maximum amount of messages that Centrifugo will keep for ",(0,o.kt)("strong",{parentName:"p"},"each")," channel in the namespace. As soon as history has more messages than defined by history size \u2013 old messages will be evicted."),(0,o.kt)("p",null,"Setting only ",(0,o.kt)("inlineCode",{parentName:"p"},"history_size")," ",(0,o.kt)("strong",{parentName:"p"},"is not enough to enable history in channels")," \u2013 you also need to wisely configure ",(0,o.kt)("inlineCode",{parentName:"p"},"history_ttl")," option (see below). "),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Enabling channel history adds some overhead (both memory and CPU) since Centrifugo needs to maintain an additional data structure (in a process memory or a broker memory/disk). So only use history for channels where it's required."))),(0,o.kt)("h3",{id:"history_ttl"},"history_ttl"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"history_ttl")," (",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/configuration#setting-time-duration-options"},"duration"),", default ",(0,o.kt)("inlineCode",{parentName:"p"},"0s"),") \u2013 interval how long to keep channel history messages (with seconds precision)."),(0,o.kt)("p",null,"As all history is storing in process memory (or in a broker memory) it is also very important to get rid of old history data for unused (inactive for a long time) channels."),(0,o.kt)("p",null,"By default history TTL duration is zero \u2013 this means that channel history is disabled."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Again \u2013 to turn on history you should wisely configure both ",(0,o.kt)("inlineCode",{parentName:"strong"},"history_size")," and ",(0,o.kt)("inlineCode",{parentName:"strong"},"history_ttl")," options"),"."),(0,o.kt)("p",null,"For example for top-level channels (which do not belong to a namespace):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "history_size": 10,\n    "history_ttl": "60s"\n}\n')),(0,o.kt)("h3",{id:"force_positioning"},"force_positioning"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"force_positioning")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 when the ",(0,o.kt)("inlineCode",{parentName:"p"},"force_positioning")," option is on Centrifugo forces all subscriptions in a namespace to be ",(0,o.kt)("inlineCode",{parentName:"p"},"positioned"),". I.e. Centrifugo will try to compensate at most once delivery of PUB/SUB broker checking client position inside a stream."),(0,o.kt)("p",null,"If Centrifugo detects a bad position of the client (i.e. potential message loss) it disconnects a client with the ",(0,o.kt)("inlineCode",{parentName:"p"},"Insufficient state")," disconnect code. Also, when the position option is enabled Centrifugo exposes the current stream top ",(0,o.kt)("inlineCode",{parentName:"p"},"offset")," and current ",(0,o.kt)("inlineCode",{parentName:"p"},"epoch")," in subscribe reply making it possible for a client to manually recover its state upon disconnect using history API."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"force_positioning")," option must be used in conjunction with reasonably configured message history for a channel i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"history_size")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"history_ttl")," ",(0,o.kt)("strong",{parentName:"p"},"must be set")," (because Centrifugo uses channel history to check client position in a stream)."),(0,o.kt)("h3",{id:"force_recovery"},"force_recovery"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"force_recovery")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 when the ",(0,o.kt)("inlineCode",{parentName:"p"},"position")," option is on Centrifugo forces all subscriptions in a namespace to be ",(0,o.kt)("inlineCode",{parentName:"p"},"recoverable"),". When enabled Centrifugo will try to recover missed publications in channels after a client reconnects for some reason (bad internet connection for example). Also when the recovery feature is on Centrifugo automatically enables properties of the ",(0,o.kt)("inlineCode",{parentName:"p"},"force_positioning")," option described above."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"force_recovery")," option must be used in conjunction with reasonably configured message history for channel i.e. ",(0,o.kt)("inlineCode",{parentName:"p"},"history_size")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"history_ttl")," ",(0,o.kt)("strong",{parentName:"p"},"must be set")," (because Centrifugo uses channel history to recover messages)."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Not all real-time events require this feature turned on so think wisely when you need this. When this option is turned on your application should be designed in a way to tolerate duplicate messages coming from a channel (currently Centrifugo returns recovered publications in order and without duplicates but this is an implementation detail that can be theoretically changed in the future). See more details about how recovery works in ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/history_and_recovery"},"special chapter"),"."))),(0,o.kt)("h3",{id:"enable_user_limited_channels"},"enable_user_limited_channels"),(0,o.kt)("p",null,"TBD"),(0,o.kt)("h3",{id:"allow_subscribe_for_client"},"allow_subscribe_for_client"),(0,o.kt)("p",null,"TBD"),(0,o.kt)("h3",{id:"allow_anonymous_access"},"allow_anonymous_access"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"allow_anonymous_access")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 this option enables anonymous user access (i.e. for a user with an empty user ID). In most situations, your application works with authenticated users so every user has its unique user ID (set inside JWT ",(0,o.kt)("inlineCode",{parentName:"p"},"sub")," claim or provided by backend when using connect proxy). But if you provide real-time features for public access you may need unauthenticated access to some channels. Turn on this option and use an empty string as a user ID. See also related global option ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/configuration#client_anonymous"},"client_anonymous")," which allows anonymous users to connect without JWT. "),(0,o.kt)("h3",{id:"allow_publish_for_subscriber"},"allow_publish_for_subscriber"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"subscribe_to_publish")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") - when the ",(0,o.kt)("inlineCode",{parentName:"p"},"publish")," option is enabled client can publish into a channel without being subscribed to it. This option enables an automatic check that the client subscribed to a channel before allowing a client to publish."),(0,o.kt)("h3",{id:"allow_publish_for_client"},"allow_publish_for_client"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"publish")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 when on allows clients to publish messages into channels directly (from a client-side)."),(0,o.kt)("p",null,"Keep in mind that your application will never receive such messages. In an idiomatic use case, all messages must be published to Centrifugo by an application backend using Centrifugo API (HTTP or GRPC). Or using ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/proxy#publish-proxy"},"publish proxy"),". Since in those cases your application has a chance to validate a message, save it into a database, and only after that broadcast to all subscribers."),(0,o.kt)("p",null,"But the ",(0,o.kt)("inlineCode",{parentName:"p"},"publish")," option still can be useful to send something without backend-side validation and saving it into a database. This option can also be handy for demos and quick prototyping real-time app ideas."),(0,o.kt)("h3",{id:"allow_history_for_subscriber"},"allow_history_for_subscriber"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"history_disable_for_client")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 allows making history available only for a server-side API. By default ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," \u2013 i.e. history calls are available for both client and server-side APIs."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"History recovery mechanism if enabled will continue to work for clients anyway even if ",(0,o.kt)("inlineCode",{parentName:"p"},"history_disable_for_client")," is on."))),(0,o.kt)("h3",{id:"allow_history_for_client"},"allow_history_for_client"),(0,o.kt)("p",null,"TBD"),(0,o.kt)("h3",{id:"allow_presence_for_subscriber"},"allow_presence_for_subscriber"),(0,o.kt)("p",null,"TBD"),(0,o.kt)("h3",{id:"allow_presence_for_client"},"allow_presence_for_client"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"presence_disable_for_client")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 allows making presence calls available only for a server-side API. By default, presence information is available for both client and server-side APIs."),(0,o.kt)("h3",{id:"proxy_subscribe"},"proxy_subscribe"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"proxy_subscribe")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 turns on subscribe proxy, more info in ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/proxy"},"proxy chapter")),(0,o.kt)("h3",{id:"proxy_publish"},"proxy_publish"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"proxy_publish")," (boolean, default ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),") \u2013 turns on publish proxy, more info in ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/proxy"},"proxy chapter")),(0,o.kt)("h3",{id:"subscribe_proxy_name"},"subscribe_proxy_name"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"subscribe_proxy_name")," (string, default ",(0,o.kt)("inlineCode",{parentName:"p"},'""'),") \u2013 turns on subscribe proxy when ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/proxy#granular-proxy-mode"},"granular proxy mode")," is used. Note that ",(0,o.kt)("inlineCode",{parentName:"p"},"proxy_subscribe")," option defined above is ignored in granular proxy mode."),(0,o.kt)("h3",{id:"publish_proxy_name"},"publish_proxy_name"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"publish_proxy_name")," (string, default ",(0,o.kt)("inlineCode",{parentName:"p"},'""'),") \u2013 turns on publish proxy when ",(0,o.kt)("a",{parentName:"p",href:"/docs/next/server/proxy#granular-proxy-mode"},"granular proxy mode")," is used. Note that ",(0,o.kt)("inlineCode",{parentName:"p"},"proxy_publish")," option defined above is ignored in granular proxy mode."),(0,o.kt)("h3",{id:"config-example"},"Config example"),(0,o.kt)("p",null,"Let's look at how to set some of these options in a config:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    "token_hmac_secret_key": "my-secret-key",\n    "api_key": "secret-api-key",\n    "presence": true,\n    "history_size": 10,\n    "history_ttl": "300s",\n    "recover": true,\n    "allow_subscribe_for_client": true,\n    "allow_anonymous_access": true,\n    "allow_publish_for_subscriber": true,\n}\n')),(0,o.kt)("p",null,"Here we set channel options on config top-level \u2013 these options will affect channels without namespace. Below we describe namespaces and how to define channel options for a namespace."),(0,o.kt)("h2",{id:"channel-namespaces"},"Channel namespaces"),(0,o.kt)("p",null,"It's possible to configure a list of channel namespaces. Namespaces are optional but very useful. "),(0,o.kt)("p",null,"A namespace allows setting custom options for channels starting with the namespace name. This provides great control over channel behavior so you have a flexible way to define different channel options for different real-time features in the application."),(0,o.kt)("p",null,"Namespace has a name, and the same channel options (with the same defaults) as described above."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"name")," - unique namespace name (name must consist of letters, numbers, underscores, or hyphens and be more than 2 symbols length i.e. satisfy regexp ",(0,o.kt)("inlineCode",{parentName:"li"},"^[-a-zA-Z0-9_]{2,}$"),").")),(0,o.kt)("p",null,"If you want to use namespace options for a channel - you must include namespace name into channel name with ",(0,o.kt)("inlineCode",{parentName:"p"},":")," as a separator:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"public:messages")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"gossips:messages")),(0,o.kt)("p",null,"Where ",(0,o.kt)("inlineCode",{parentName:"p"},"public")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"gossips")," are namespace names. Centrifugo will look for ",(0,o.kt)("inlineCode",{parentName:"p"},":")," symbol in the channel name, will extract the namespace name, and will apply namespace options whenever required."),(0,o.kt)("p",null,"All things together here is an example of ",(0,o.kt)("inlineCode",{parentName:"p"},"config.json")," which includes some top-level channel options set and has 2 additional channel namespaces configured:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    "token_hmac_secret_key": "very-long-secret-key",\n    "api_key": "secret-api-key",\n    "anonymous": true,\n    "publish": true,\n    "presence": true,\n    "join_leave": true,\n    "history_size": 10,\n    "history_ttl": "30s",\n    "namespaces": [\n        {\n          "name": "public",\n          "publish": true,\n          "anonymous": true,\n          "history_size": 10,\n          "history_ttl": "300s",\n          "recover": true\n        },\n        {\n          "name": "gossips",\n          "presence": true,\n          "join_leave": true\n        }\n    ]\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Channel ",(0,o.kt)("inlineCode",{parentName:"li"},"news")," will use globally defined channel options."),(0,o.kt)("li",{parentName:"ul"},"Channel ",(0,o.kt)("inlineCode",{parentName:"li"},"public:news")," will use ",(0,o.kt)("inlineCode",{parentName:"li"},"public")," namespace options."),(0,o.kt)("li",{parentName:"ul"},"Channel ",(0,o.kt)("inlineCode",{parentName:"li"},"gossips:news")," will use ",(0,o.kt)("inlineCode",{parentName:"li"},"gossips")," namespace options."),(0,o.kt)("li",{parentName:"ul"},"Channel ",(0,o.kt)("inlineCode",{parentName:"li"},"xxx:hello")," will result into subscription error since there is no ",(0,o.kt)("inlineCode",{parentName:"li"},"xxx")," namespace defined inn configuration above.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Channel namespaces also work with private channels and user-limited channels"),". For example, if you have a namespace called ",(0,o.kt)("inlineCode",{parentName:"p"},"dialogs")," then the private channel can be constructed as ",(0,o.kt)("inlineCode",{parentName:"p"},"$dialogs:gossips"),", user-limited channel can be constructed as ",(0,o.kt)("inlineCode",{parentName:"p"},"dialogs:dialog#1,2"),"."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"There is no inheritance in channel options and namespaces \u2013 for example, you defined ",(0,o.kt)("inlineCode",{parentName:"p"},"presence: true")," on a top level of configuration and then defined a namespace \u2013 that namespace won't have online presence enabled - you must enable it for a namespace explicitly. "))),(0,o.kt)("h2",{id:"channel-permissions-for-server-api"},"Channel permissions for server API"),(0,o.kt)("p",null,"When using Centrifugo server API you don't need to think about channel permissions at all \u2013 everything is allowed. In case of server API request to Centrifugo must be issued by your application backend \u2013 so you have all the power to check any required permissions before issuing API request to Centrifugo."),(0,o.kt)("p",null,"The situation is different when we are talking about client real-time API. See details below."),(0,o.kt)("h2",{id:"channel-permissions-for-client-api"},"Channel permissions for client API"),(0,o.kt)("p",null,"In order to configure which client (i.e. connection established using one of supported bidirectional real-time transports) can subscribe to channels and call publish, history and presence real-time APIs Centrifugo provides several ways to configure the desired behavior."),(0,o.kt)("p",null,"Let's start from looking at Centrifugo subscribe permission model."),(0,o.kt)("h3",{id:"subscribe-permission-model"},"Subscribe permission model"),(0,o.kt)("p",null,"By default, client's attempt to subscribe on a channel will be rejected by a server with ",(0,o.kt)("inlineCode",{parentName:"p"},"103: permission denied")," error. There are several approaches how to control channel subscribe permissions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#provide-subscription-token"},"Provide subscription token")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#configure-subscribe-proxy"},"Configure subscribe proxy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#subscribe-capabilities-in-connection-token"},"Subscribe capabilities in connection token")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#subscribe-capabilities-in-connect-proxy"},"Subscribe capabilities in connect proxy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#use-user-limited-channels"},"Use user-limited channels")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#use-subscribe-cel-expression"},"Use subscribe CEL expression")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#use-subscribeallowedforclient-namespace-option"},"Use subscribe_allowed_for_client namespace option"))),(0,o.kt)("p",null,"Below, we are describing those in detail."),(0,o.kt)("h4",{id:"provide-subscription-token"},"Provide subscription token"),(0,o.kt)("p",null,"A client can provide a subscription token in subscribe request. See the format of the token."),(0,o.kt)("p",null,"If client provides a valid token then subscription will be accepted. Token can additionally grant ",(0,o.kt)("inlineCode",{parentName:"p"},"publish"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"history")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"presence")," permissions to a client."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"For namespaces with ",(0,o.kt)("inlineCode",{parentName:"p"},"allow_subscribe_for_client")," option ON Centrifugo does not allow subscribing on channels starting with ",(0,o.kt)("inlineCode",{parentName:"p"},"private_channel_prefix")," (",(0,o.kt)("inlineCode",{parentName:"p"},"$")," by default) without token. This limitation exists to help users migrate to Centrifugo v4 without security risks. You can disable this limitation by setting ",(0,o.kt)("inlineCode",{parentName:"p"},"private_channel_prefix")," option to ",(0,o.kt)("inlineCode",{parentName:"p"},'""')," (empty string)."))),(0,o.kt)("h4",{id:"configure-subscribe-proxy"},"Configure subscribe proxy"),(0,o.kt)("p",null,"If client subscribes on a namespace with configured subscribe proxy then depending on proxy response subscription will be accepted or not."),(0,o.kt)("p",null,"If a namespace has configured subscribe proxy, but user came with a token \u2013 then subscribe proxy is not used, we are relying on token in this case. If a namespace has subscribe proxy, but user subscribes on a user-limited channel \u2013 then subscribe proxy is not used also."),(0,o.kt)("h4",{id:"use-user-limited-channels"},"Use user-limited channels"),(0,o.kt)("p",null,"If client subscribes on a user-limited channel and there is a user ID match then subscription will be accepted."),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"User-limited channels must be enabled in a namespace using ",(0,o.kt)("inlineCode",{parentName:"p"},"enable_user_limited_channels")," option."))),(0,o.kt)("h4",{id:"subscribe-capabilities-in-connection-token"},"Subscribe capabilities in connection token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow user subscribe to channels."),(0,o.kt)("h4",{id:"subscribe-capabilities-in-connect-proxy"},"Subscribe capabilities in connect proxy"),(0,o.kt)("p",null,"Connect proxy can return capability object to allow user subscribe to channels."),(0,o.kt)("h4",{id:"use-subscribe-cel-expression"},"Use subscribe CEL expression"),(0,o.kt)("p",null,"If namespace contains subscribe expression then it's checked to return ",(0,o.kt)("inlineCode",{parentName:"p"},"true")),(0,o.kt)("h4",{id:"use-subscribe_allowed_for_client-namespace-option"},"Use subscribe_allowed_for_client namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"subscribe_allowed_for_client")," allows all connections to subscribe on all channels in a namespace."),(0,o.kt)("h3",{id:"publish-permission-model"},"Publish permission model"),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"In idiomatic Centrifugo use case data should be published to channels from the application backend (over server API). In this case backend can validate data, save it into persistent storage before publishing in real-time towards connections. When publishing from the client-side backend does not receive publication data at all \u2013 it just goes through Centrifugo (except using publish proxy). There are cases when direct publications from the client-side are desired (like typing indicators in chat applications) though."))),(0,o.kt)("p",null,"By default, client's attempt to publish data into a channel will be rejected by a server with ",(0,o.kt)("inlineCode",{parentName:"p"},"103: permission denied")," error. There are several approaches how to control channel publish permissions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#publish-capabilities-in-connection-token"},"Publish capabilities in connection token")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#publish-capability-in-subscription-token"},"Publish capability in subscription token")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#publish-capabilities-in-connect-proxy"},"Publish capabilities in connect proxy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#publish-capability-in-subscribe-proxy"},"Publish capability in subscribe proxy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#configure-publish-proxy"},"Configure publish proxy")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#use-publishallowedforsubscriber-namespace-option"},"Use publish_allowed_for_subscriber namespace option")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"#use-publishallowedforclient-namespace-option"},"Use publish_allowed_for_client namespace option"))),(0,o.kt)("h4",{id:"publish-capabilities-in-connection-token"},"Publish capabilities in connection token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow client to publish to channels."),(0,o.kt)("h4",{id:"publish-capability-in-subscription-token"},"Publish capability in subscription token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow client to publish to a channel."),(0,o.kt)("h4",{id:"publish-capabilities-in-connect-proxy"},"Publish capabilities in connect proxy"),(0,o.kt)("p",null,"Connect proxy can return capability object to allow client publish to certain channels."),(0,o.kt)("h4",{id:"publish-capability-in-subscribe-proxy"},"Publish capability in subscribe proxy"),(0,o.kt)("p",null,"Subscribe proxy can return capability object to allow subscriber publish to channel."),(0,o.kt)("h4",{id:"use-publish_allowed_for_client-namespace-option"},"Use publish_allowed_for_client namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"publish_allowed_for_client")," allows publications to channels of a namespace for all client connections. "),(0,o.kt)("h4",{id:"use-publish_allowed_for_subscriber-namespace-option"},"Use publish_allowed_for_subscriber namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"publish_allowed_for_subscriber")," allows publications to channels of a namespace for all connections subscribed on a channel they want to publish data into."),(0,o.kt)("h4",{id:"configure-publish-proxy"},"Configure publish proxy"),(0,o.kt)("p",null,"If client publishes to a namespace with configured publish proxy then depending on proxy response publication will be accepted or not."),(0,o.kt)("p",null,"Configured publish proxy always used??? (what if user has permission in token or publish_allowed_for_client?)"),(0,o.kt)("h3",{id:"history-permission-model"},"History permission model"),(0,o.kt)("p",null,"By default, client's attempt to call history from a channel (with history retention configured) will be rejected by a server with ",(0,o.kt)("inlineCode",{parentName:"p"},"103: permission denied")," error. There are several approaches how to control channel history permissions."),(0,o.kt)("h4",{id:"use-history_allowed_for_client-namespace-option"},"Use history_allowed_for_client namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"history_allowed_for_client")," allows history requests to all channels in a namespace for all client connections. "),(0,o.kt)("h4",{id:"use-history_allowed_for_subscriber-namespace-option"},"Use history_allowed_for_subscriber namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"history_allowed_for_subscriber")," allows history requests to all channels in a namespace for all client connections subscribed on a channel they want to call history for."),(0,o.kt)("h4",{id:"history-capabilities-in-connection-token"},"History capabilities in connection token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow user call history for channels."),(0,o.kt)("h4",{id:"history-capabilities-in-subscription-token"},"History capabilities in subscription token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow user call history from a channel."),(0,o.kt)("h4",{id:"history-capabilities-in-connect-proxy"},"History capabilities in connect proxy"),(0,o.kt)("p",null,"Connect proxy can return capability object to allow client call history from certain channels."),(0,o.kt)("h4",{id:"history-capability-in-subscribe-proxy-response"},"History capability in subscribe proxy response"),(0,o.kt)("p",null,"Subscribe proxy can return capability object to allow subscriber call history from channel."),(0,o.kt)("h3",{id:"presence-permission-model"},"Presence permission model"),(0,o.kt)("p",null,"By default, client's attempt to call presence from a channel (with channel presence configured) will be rejected by a server with ",(0,o.kt)("inlineCode",{parentName:"p"},"103: permission denied")," error. There are several approaches how to control channel presence permissions."),(0,o.kt)("h4",{id:"presence-capabilities-in-connection-token"},"Presence capabilities in connection token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow user call presence for channels."),(0,o.kt)("h4",{id:"presence-capabilities-in-subscription-token"},"Presence capabilities in subscription token"),(0,o.kt)("p",null,"Connection token can contain a capability object to allow user call presence of a channel."),(0,o.kt)("h4",{id:"presence-capabilities-in-connect-proxy"},"Presence capabilities in connect proxy"),(0,o.kt)("p",null,"Connect proxy can return capability object to allow client call presence from certain channels."),(0,o.kt)("h4",{id:"presence-capability-in-subscribe-proxy-response"},"Presence capability in subscribe proxy response"),(0,o.kt)("p",null,"Subscribe proxy can return capability object to allow subscriber call presence from channel."),(0,o.kt)("h4",{id:"use-presence_allowed_for_client-namespace-option"},"Use presence_allowed_for_client namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"presence_allowed_for_client")," allows presence requests to all channels in a namespace for all client connections. "),(0,o.kt)("h4",{id:"use-presence_allowed_for_subscriber-namespace-option"},"Use presence_allowed_for_subscriber namespace option"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"presence_allowed_for_subscriber")," allows presence requests to all channels in a namespace for all client connections subscribed on a channel they want to call presence for."),(0,o.kt)("h3",{id:"positioning-permission-model"},"Positioning permission model"),(0,o.kt)("p",null,"Server can whether turn on positioning for all channels in a namespace using ",(0,o.kt)("inlineCode",{parentName:"p"},'"position": true')," option or client can create positioned subscriptions (but in this case it should have ",(0,o.kt)("inlineCode",{parentName:"p"},"history")," capability)."),(0,o.kt)("h3",{id:"recovery-permission-model"},"Recovery permission model"),(0,o.kt)("p",null,"Server can whether turn on automatic recovery for all channels in a namespace using ",(0,o.kt)("inlineCode",{parentName:"p"},'"recover": true')," option or client can create recoverable subscriptions (but in this case it should have ",(0,o.kt)("inlineCode",{parentName:"p"},"history")," capability)."))}d.isMDXComponent=!0}}]);