"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[4114],{3905:function(t,e,n){n.d(e,{Zo:function(){return m},kt:function(){return c}});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var p=a.createContext({}),s=function(t){var e=a.useContext(p),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},m=function(t){var e=s(t.components);return a.createElement(p.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,p=t.parentName,m=o(t,["components","mdxType","originalType","parentName"]),d=s(n),c=r,k=d["".concat(p,".").concat(c)]||d[c]||u[c]||l;return n?a.createElement(k,i(i({ref:e},m),{},{components:n})):a.createElement(k,i({ref:e},m))}));function c(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var p in e)hasOwnProperty.call(e,p)&&(o[p]=e[p]);o.originalType=t,o.mdxType="string"==typeof t?t:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6421:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return m},default:function(){return d}});var a=n(2122),r=n(9756),l=(n(7294),n(3905)),i=["components"],o={id:"server_api",title:"Server API"},p=void 0,s={unversionedId:"server/server_api",id:"server/server_api",isDocsHomePage:!1,title:"Server API",description:"Server API is a way to send various commands to Centrifugo. For example, server API allows publishing messages to channels, get server statistics, etc. There are two kinds of API available at the moment:",source:"@site/docs/server/server_api.md",sourceDirName:"server",slug:"/server/server_api",permalink:"/docs/server/server_api",editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/server_api.md",version:"current",frontMatter:{id:"server_api",title:"Server API"},sidebar:"Guides",previous:{title:"Console commands",permalink:"/docs/server/console_commands"},next:{title:"Client authentication",permalink:"/docs/server/authentication"}},m=[{value:"HTTP API",id:"http-api",children:[{value:"HTTP API authorization",id:"http-api-authorization",children:[]},{value:"publish",id:"publish",children:[]},{value:"broadcast",id:"broadcast",children:[]},{value:"subscribe",id:"subscribe",children:[]},{value:"unsubscribe",id:"unsubscribe",children:[]},{value:"disconnect",id:"disconnect",children:[]},{value:"refresh",id:"refresh",children:[]},{value:"presence",id:"presence",children:[]},{value:"presence_stats",id:"presence_stats",children:[]},{value:"history",id:"history",children:[]},{value:"history_remove",id:"history_remove",children:[]},{value:"channels",id:"channels",children:[]},{value:"info",id:"info",children:[]},{value:"Command pipelining",id:"command-pipelining",children:[]}]},{value:"GRPC API",id:"grpc-api",children:[{value:"GRPC example for Python",id:"grpc-example-for-python",children:[]},{value:"GRPC example for Go",id:"grpc-example-for-go",children:[]},{value:"GRPC API key authorization",id:"grpc-api-key-authorization",children:[]}]}],u={toc:m};function d(t){var e=t.components,n=(0,r.Z)(t,i);return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"Server API is a way to send various commands to Centrifugo. For example, server API allows publishing messages to channels, get server statistics, etc. There are two kinds of API available at the moment:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"HTTP API"),(0,l.kt)("li",{parentName:"ul"},"GRPC API")),(0,l.kt)("h2",{id:"http-api"},"HTTP API"),(0,l.kt)("p",null,"Server HTTP API works on ",(0,l.kt)("inlineCode",{parentName:"p"},"/api")," endpoint (by default). It has a simple request format: this is an HTTP POST request with ",(0,l.kt)("inlineCode",{parentName:"p"},"application/json")," Content-Type and with JSON command body."),(0,l.kt)("p",null,"Here we will look at available methods and parameters"),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"In some cases, you can just use one of our ",(0,l.kt)("a",{parentName:"p",href:"/docs/ecosystem/api"},"available HTTP API libraries")," or use Centrifugo ",(0,l.kt)("a",{parentName:"p",href:"#grpc-api"},"GRPC API")," to avoid manually constructing requests."))),(0,l.kt)("h3",{id:"http-api-authorization"},"HTTP API authorization"),(0,l.kt)("p",null,"HTTP API protected by ",(0,l.kt)("inlineCode",{parentName:"p"},"api_key")," set in Centrifugo configuration. I.e. ",(0,l.kt)("inlineCode",{parentName:"p"},"api_key")," option must be added to config, like:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "api_key": "<YOUR API KEY>"\n}\n')),(0,l.kt)("p",null,"This API key must be set in the request ",(0,l.kt)("inlineCode",{parentName:"p"},"Authorization")," header in this way:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"Authorization: apikey <KEY>\n")),(0,l.kt)("p",null,"It's also possible to pass API key over URL query param. This solves some edge cases where it's not possible to use the ",(0,l.kt)("inlineCode",{parentName:"p"},"Authorization")," header. Simply add ",(0,l.kt)("inlineCode",{parentName:"p"},"?api_key=<YOUR API KEY>")," query param to the API endpoint. Keep in mind that passing the API key in the ",(0,l.kt)("inlineCode",{parentName:"p"},"Authorization")," header is a recommended way. "),(0,l.kt)("p",null,"It's possible to disable API key check on Centrifugo side using the ",(0,l.kt)("inlineCode",{parentName:"p"},"api_insecure")," configuration option. Be sure to protect the API endpoint by firewall rules, in this case, to prevent anyone on the internet to send commands over your unprotected Centrifugo API endpoint. API key auth is not very safe for man-in-the-middle so we also recommended running Centrifugo with TLS."),(0,l.kt)("p",null,"A command is a JSON object with two properties: ",(0,l.kt)("inlineCode",{parentName:"p"},"method")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"params"),"."),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"method")," is the name of the API command you want to call."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("inlineCode",{parentName:"li"},"params")," is an object with command arguments. Each ",(0,l.kt)("inlineCode",{parentName:"li"},"method")," can have its own ",(0,l.kt)("inlineCode",{parentName:"li"},"params"))),(0,l.kt)("p",null,"Before looking at all available commands here is a CURL that calls ",(0,l.kt)("inlineCode",{parentName:"p"},"info")," command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'curl --header "Authorization: apikey <API_KEY>" \\\n  --request POST \\\n  --data \'{"method": "info", "params": {}\' \\\n  http://localhost:8000/api\n')),(0,l.kt)("p",null,"Here is a live example:"),(0,l.kt)("iframe",{width:"100%",height:"400",src:"/img/api_example.mp4",frameborder:"0",allow:"accelerometer; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0}),(0,l.kt)("p",null,"Now let's investigate each API method in detail."),(0,l.kt)("h3",{id:"publish"},"publish"),(0,l.kt)("p",null,"Publish command allows publishing data into a channel. Most probably this is a command you'll use most."),(0,l.kt)("p",null,"It looks like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "publish",\n    "params": {\n        "channel": "chat", \n        "data": {\n            "text": "hello"\n        }\n    } \n}\n')),(0,l.kt)("p",null,"Let's apply all information said above and send publish command to Centrifugo. We will send a request using the ",(0,l.kt)("inlineCode",{parentName:"p"},"requests")," library for Python. "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},'import json\nimport requests\n\ncommand = {\n    "method": "publish",\n    "params": {\n        "channel": "docs", \n        "data": {\n            "content": "1"\n        }\n    }\n}\n\napi_key = "YOUR_API_KEY"\ndata = json.dumps(command)\nheaders = {\'Content-type\': \'application/json\', \'Authorization\': \'apikey \' + api_key}\nresp = requests.post("https://centrifuge.example.com/api", data=data, headers=headers)\nprint(resp.json())\n')),(0,l.kt)("p",null,"The same using ",(0,l.kt)("inlineCode",{parentName:"p"},"httpie")," console tool:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "publish", "params": {"channel": "chat", "data": {"text": "hello"}}}\' | http "localhost:8000/api" Authorization:"apikey <YOUR_API_KEY>" -vvv\nPOST /api HTTP/1.1\nAccept: application/json, */*\nAccept-Encoding: gzip, deflate\nAuthorization: apikey KEY\nConnection: keep-alive\nContent-Length: 80\nContent-Type: application/json\nHost: localhost:8000\nUser-Agent: HTTPie/0.9.8\n\n{\n    "method": "publish",\n    "params": {\n        "channel": "chat",\n        "data": {\n            "text": "hello"\n        }\n    }\n}\n\nHTTP/1.1 200 OK\nContent-Length: 3\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:01:42 GMT\n\n{\n    "result": {}\n}\n')),(0,l.kt)("p",null,"In case of error response object can contain ",(0,l.kt)("inlineCode",{parentName:"p"},"error")," field (here we artificially publishing to a channel with unknown namespace):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "publish", "params": {"channel": "unknown:chat", "data": {"text": "hello"}}}\' | http "localhost:8000/api" Authorization:"apikey <YOUR_API_KEY>"\nHTTP/1.1 200 OK\nContent-Length: 55\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:03:09 GMT\n\n{\n    "error": {\n        "code": 102,\n        "message": "namespace not found"\n    }\n}\n')),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"error")," object contains error code and message - this is also the same for other commands described below."),(0,l.kt)("h4",{id:"publish-params"},"Publish params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to publish")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"any JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Custom JSON data to publish into a channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"skip_history"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Skip adding publication to history for this request")))),(0,l.kt)("h4",{id:"publish-result"},"Publish result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"offset"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Offset of publication in history stream")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"epoch"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Epoch of current stream")))),(0,l.kt)("h3",{id:"broadcast"},"broadcast"),(0,l.kt)("p",null,"Similar to ",(0,l.kt)("inlineCode",{parentName:"p"},"publish")," but allows to send the same data into many channels."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "broadcast",\n    "params": {\n        "channels": ["CHANNEL_1", "CHANNEL_2"],\n        "data": {\n            "text": "hello"\n        }\n    }\n}\n')),(0,l.kt)("h4",{id:"broadcast-params"},"Broadcast params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channels"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of strings"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"List of channels to publish data to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"any JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Custom JSON data to publish into each channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"skip_history"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Skip adding publications to channels' history for this request")))),(0,l.kt)("h4",{id:"broadcast-result"},"Broadcast result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"responses"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of publish responses"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Responses for each individual publish (with possible error and publish result)")))),(0,l.kt)("h3",{id:"subscribe"},"subscribe"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"subscribe")," allows subscribing user to a channel."),(0,l.kt)("h4",{id:"subscribe-params"},"Subscribe params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to subscribe")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to subscribe user to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"info"),(0,l.kt)("td",{parentName:"tr",align:null},"any JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Attach custom data to subscription (will be used in presence and join/leave messages)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"b64info"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"info in base64 for binary mode (will be decoded by Centrifugo)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"client"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Specific client ID to subscribe (user still required to be set, will ignore other user connections with different client IDs)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"data"),(0,l.kt)("td",{parentName:"tr",align:null},"any JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Custom subscription data (will be sent to client in Subscribe push)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"b64data"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Same as data but in base64 format (will be decoded by Centrifugo)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"recover_since"),(0,l.kt)("td",{parentName:"tr",align:null},"StreamPosition object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Stream position to recover from")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"override"),(0,l.kt)("td",{parentName:"tr",align:null},"Override object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Allows dynamically override some channel options defined in Centrifugo configuration (see below available fields)")))),(0,l.kt)("h4",{id:"override-object"},"Override object"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field"),(0,l.kt)("th",{parentName:"tr",align:null},"Type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"presence"),(0,l.kt)("td",{parentName:"tr",align:null},"BoolValue"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Override presence")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"join_leave"),(0,l.kt)("td",{parentName:"tr",align:null},"BoolValue"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Override join_leave")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"position"),(0,l.kt)("td",{parentName:"tr",align:null},"BoolValue"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Override position")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"recover"),(0,l.kt)("td",{parentName:"tr",align:null},"BoolValue"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Override recover")))),(0,l.kt)("p",null,"BoolValue is an object like this:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "value": true/false\n}\n')),(0,l.kt)("h4",{id:"subscribe-result"},"Subscribe result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"unsubscribe"},"unsubscribe"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"unsubscribe")," allows unsubscribing user from a channel."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "unsubscribe",\n    "params": {\n        "channel": "CHANNEL NAME",\n        "user": "USER ID"\n    }\n}\n')),(0,l.kt)("h4",{id:"unsubscribe-params"},"Unsubscribe params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to subscribe")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to subscribe user to")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"client"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Specific client ID to unsubscribe (user still required to be set)")))),(0,l.kt)("h4",{id:"unsubscribe-result"},"Unsubscribe result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"disconnect"},"disconnect"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"disconnect")," allows disconnecting a user by ID."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "disconnect",\n    "params": {\n        "user": "USER ID"\n    }\n}\n')),(0,l.kt)("h4",{id:"disconnect-params"},"Disconnect params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to disconnect")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"client"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Specific client ID to disconnect (user still required to be set)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"whitelist"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of strings"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of client IDs to keep")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"disconnect"),(0,l.kt)("td",{parentName:"tr",align:null},"Disconnect object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Provide custom disconnect object, see below")))),(0,l.kt)("h4",{id:"disconnect-object"},"Disconnect object"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"code"),(0,l.kt)("td",{parentName:"tr",align:null},"int"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Disconnect code")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"reason"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Disconnect reason")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"reconnect"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Reconnect advice")))),(0,l.kt)("h4",{id:"disconnect-result"},"Disconnect result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"refresh"},"refresh"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"refresh")," allows refreshing user connection (mostly useful when unidirectional transports are used)."),(0,l.kt)("h4",{id:"refresh-params"},"Refresh params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID to refresh")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"client"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Client ID to refresh")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"expired"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Mark connection as expired and close with Disconnect Expired reason")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"expire_at"),(0,l.kt)("td",{parentName:"tr",align:null},"int"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Unix time (in seconds) in the future when the connection will expire")))),(0,l.kt)("h4",{id:"refresh-result"},"Refresh result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"presence"},"presence"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"presence")," allows getting channel presence information (all clients currently subscribed on this channel)."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Presence in channels is not enabled by default. See how to enable it over ",(0,l.kt)("a",{parentName:"p",href:"/docs/server/channels#channel-options"},"channel options"),"."))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "presence",\n    "params": {\n        "channel": "chat"\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'fz@centrifugo: echo \'{"method": "presence", "params": {"channel": "chat"}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 127\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:13:17 GMT\n\n{\n    "result": {\n        "presence": {\n            "c54313b2-0442-499a-a70c-051f8588020f": {\n                "client": "c54313b2-0442-499a-a70c-051f8588020f",\n                "user": "42"\n            },\n            "adad13b1-0442-499a-a70c-051f858802da": {\n                "client": "adad13b1-0442-499a-a70c-051f858802da",\n                "user": "42"\n            }\n        }\n    }\n}\n')),(0,l.kt)("h4",{id:"presence-params"},"Presence params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to call presence from")))),(0,l.kt)("h4",{id:"presence-result"},"Presence result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"presence"),(0,l.kt)("td",{parentName:"tr",align:null},"Map of client ID (string) to ClientInfo object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Offset of publication in history stream")))),(0,l.kt)("h4",{id:"clientinfo"},"ClientInfo"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"client"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Client ID")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"user"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"User ID")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"conn_info"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Optional connection info")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"chan_info"),(0,l.kt)("td",{parentName:"tr",align:null},"JSON"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Optional channel info")))),(0,l.kt)("h3",{id:"presence_stats"},"presence_stats"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"presence_stats")," allows getting short channel presence information."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "presence_stats",\n    "params": {\n        "channel": "chat"\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "presence_stats", "params": {"channel": "public:chat"}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 43\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:09:44 GMT\n\n{\n    "result": {\n        "num_clients": 0,\n        "num_users": 0\n    }\n}\n')),(0,l.kt)("h4",{id:"presence-stats-params"},"Presence stats params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to call presence from")))),(0,l.kt)("h4",{id:"presence-stats-result"},"Presence stats result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"num_clients"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Total number of clients in channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"num_users"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Total number of unique users in channel")))),(0,l.kt)("h3",{id:"history"},"history"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"history")," allows getting channel history information (list of last messages published into the channel). By default if no ",(0,l.kt)("inlineCode",{parentName:"p"},"limit")," parameter set in request ",(0,l.kt)("inlineCode",{parentName:"p"},"history")," call will only return current stream position information - i.e. ",(0,l.kt)("inlineCode",{parentName:"p"},"offset")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"epoch")," fields. To get publications you must explicitly provide ",(0,l.kt)("inlineCode",{parentName:"p"},"limit")," parameter. See also history API description in ",(0,l.kt)("a",{parentName:"p",href:"/docs/server/history_and_recovery#history-iteration-api"},"special doc chapter"),"."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"History in channels is not enabled by default. See how to enable it over ",(0,l.kt)("a",{parentName:"p",href:"/docs/server/channels#channel-options"},"channel options"),"."))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "history",\n    "params": {\n        "channel": "chat",\n        "limit": 2\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "history", "params": {"channel": "chat", "limit": 2}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 129\nContent-Type: application/json\nDate: Wed, 21 Jul 2021 05:30:48 GMT\n\n{\n    "result": {\n        "epoch": "qFhv",\n        "offset": 4,\n        "publications": [\n            {\n                "data": {\n                    "text": "hello"\n                },\n                "offset": 2\n            },\n            {\n                "data": {\n                    "text": "hello"\n                },\n                "offset": 3\n            }\n        ]\n    }\n}\n')),(0,l.kt)("h4",{id:"history-params"},"History params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to call history from")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"limit"),(0,l.kt)("td",{parentName:"tr",align:null},"int"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Limit number of returned publications, if not set in request then only current stream position information will present in result (without any publications)")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"since"),(0,l.kt)("td",{parentName:"tr",align:null},"StreamPosition object"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"To return publications after this position")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"reverse"),(0,l.kt)("td",{parentName:"tr",align:null},"bool"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Iterate in reversed order (from latest to earliest)")))),(0,l.kt)("h4",{id:"streamposition"},"StreamPosition"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"offset"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Offset in a stream")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"epoch"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Stream epoch")))),(0,l.kt)("h4",{id:"history-result"},"History result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"publications"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of publication objects"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"List of publications in channel")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"offset"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Top offset in history stream")),(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"epoch"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Epoch of current stream")))),(0,l.kt)("h3",{id:"history_remove"},"history_remove"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"history_remove")," allows removing publications in channel history. Current top stream position meta data kept untouched to avoid client disconnects due to insufficient state."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "history_remove",\n    "params": {\n        "channel": "chat"\n    }\n}\n')),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "history_remove", "params": {"channel": "chat"}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 43\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:09:44 GMT\n\n{\n    "result": {}\n}\n')),(0,l.kt)("h4",{id:"history-remove-params"},"History remove params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channel"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"yes"),(0,l.kt)("td",{parentName:"tr",align:null},"Name of channel to remove history")))),(0,l.kt)("h4",{id:"history-remove-result"},"History remove result"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h3",{id:"channels"},"channels"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"channels")," return active channels (with one or more active subscribers in it)."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "method": "channels",\n    "params": {}\n}\n')),(0,l.kt)("h4",{id:"channels-params"},"Channels params"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Parameter name"),(0,l.kt)("th",{parentName:"tr",align:null},"Parameter type"),(0,l.kt)("th",{parentName:"tr",align:null},"Required"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"pattern"),(0,l.kt)("td",{parentName:"tr",align:null},"string"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Pattern to filter channels")))),(0,l.kt)("h4",{id:"channels-result"},"Channels result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"channels"),(0,l.kt)("td",{parentName:"tr",align:null},"Map of string to ChannelInfo"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Map where key is channel and value is ChannelInfo (see below)")))),(0,l.kt)("h4",{id:"channelinfo"},"ChannelInfo"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"num_clients"),(0,l.kt)("td",{parentName:"tr",align:null},"integer"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Total number of connections currently subscribed to a channel")))),(0,l.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"Keep in mind that since the ",(0,l.kt)("inlineCode",{parentName:"p"},"channels")," method by default returns all active channels it can be really heavy for massive deployments. Centrifugo does not provide a way to paginate over channels list. At the moment we mostly suppose that ",(0,l.kt)("inlineCode",{parentName:"p"},"channels")," RPC extension will be used in the development process or for administrative/debug purposes, and in not very massive Centrifugo setups (with no more than 10k active channels). A better and scalable approach for huge setups could be a real-time analytics approach ",(0,l.kt)("a",{parentName:"p",href:"/docs/pro/analytics"},"described here"),"."))),(0,l.kt)("h3",{id:"info"},"info"),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"info")," method allows getting information about running Centrifugo nodes."),(0,l.kt)("p",null,"Example:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},'echo \'{"method": "info", "params": {}}\' | http "localhost:8000/api" Authorization:"apikey KEY"\nHTTP/1.1 200 OK\nContent-Length: 184\nContent-Type: application/json\nDate: Thu, 17 May 2018 22:07:58 GMT\n\n{\n    "result": {\n        "nodes": [\n            {\n                "name": "Alexanders-MacBook-Pro.local_8000",\n                "num_channels": 0,\n                "num_clients": 0,\n                "num_users": 0,\n                "uid": "f844a2ed-5edf-4815-b83c-271974003db9",\n                "uptime": 0,\n                "version": ""\n            }\n        ]\n    }\n}\n')),(0,l.kt)("h4",{id:"info-params"},"Info params"),(0,l.kt)("p",null,"Empty object at the moment."),(0,l.kt)("h4",{id:"info-result"},"Info result"),(0,l.kt)("table",null,(0,l.kt)("thead",{parentName:"table"},(0,l.kt)("tr",{parentName:"thead"},(0,l.kt)("th",{parentName:"tr",align:null},"Field name"),(0,l.kt)("th",{parentName:"tr",align:null},"Field type"),(0,l.kt)("th",{parentName:"tr",align:null},"Optional"),(0,l.kt)("th",{parentName:"tr",align:null},"Description"))),(0,l.kt)("tbody",{parentName:"table"},(0,l.kt)("tr",{parentName:"tbody"},(0,l.kt)("td",{parentName:"tr",align:null},"nodes"),(0,l.kt)("td",{parentName:"tr",align:null},"Array of Node objects"),(0,l.kt)("td",{parentName:"tr",align:null},"no"),(0,l.kt)("td",{parentName:"tr",align:null},"Information about all nodes in a cluster")))),(0,l.kt)("h3",{id:"command-pipelining"},"Command pipelining"),(0,l.kt)("p",null,"It's possible to combine several commands into one request to Centrifugo. To do this use ",(0,l.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/JSON_streaming"},"JSON streaming")," format. This can improve server throughput and reduce traffic traveling around."),(0,l.kt)("h2",{id:"grpc-api"},"GRPC API"),(0,l.kt)("p",null,"Centrifugo also supports ",(0,l.kt)("a",{parentName:"p",href:"https://grpc.io/"},"GRPC")," API. With GRPC it's possible to communicate with Centrifugo using a more compact binary representation of commands and use the power of HTTP/2 which is the transport behind GRPC."),(0,l.kt)("p",null,"GRPC API is also useful if you want to publish binary data to Centrifugo channels."),(0,l.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,l.kt)("div",{parentName:"div",className:"admonition-heading"},(0,l.kt)("h5",{parentName:"div"},(0,l.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,l.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,l.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,l.kt)("div",{parentName:"div",className:"admonition-content"},(0,l.kt)("p",{parentName:"div"},"GRPC API allows calling all commands described in ",(0,l.kt)("a",{parentName:"p",href:"#http-api"},"HTTP API doc"),", actually both GRPC and HTTP API in Centrifugo based on the same Protobuf schema definition. So refer to the HTTP API description doc for the parameter and the result field description."))),(0,l.kt)("p",null,"You can enable GRPC API in Centrifugo using ",(0,l.kt)("inlineCode",{parentName:"p"},"grpc_api")," option:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="config.json"',title:'"config.json"'},'{\n    ...\n    "grpc_api": true\n}\n')),(0,l.kt)("p",null,"By default, GRPC will be served on port ",(0,l.kt)("inlineCode",{parentName:"p"},"10000")," but you can change it using the ",(0,l.kt)("inlineCode",{parentName:"p"},"grpc_api_port")," option."),(0,l.kt)("p",null,"Now, as soon as Centrifugo started \u2013 you can send GRPC commands to it. To do this get our API Protocol Buffer definitions ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/blob/master/internal/apiproto/api.proto"},"from this file"),"."),(0,l.kt)("p",null,"Then see ",(0,l.kt)("a",{parentName:"p",href:"https://grpc.io/docs/"},"GRPC docs specific to your language")," to find out how to generate client code from definitions and use generated code to communicate with Centrifugo."),(0,l.kt)("h3",{id:"grpc-example-for-python"},"GRPC example for Python"),(0,l.kt)("p",null,"For example for Python you need to run sth like this according to GRPC docs:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"pip install grpcio-tools\npython -m grpc_tools.protoc -I ./ --python_out=. --grpc_python_out=. api.proto\n")),(0,l.kt)("p",null,"As soon as you run the command you will have 2 generated files: ",(0,l.kt)("inlineCode",{parentName:"p"},"api_pb2.py")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"api_pb2_grpc.py"),". Now all you need is to write a simple program that uses generated code and sends GRPC requests to Centrifugo:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-python"},"import grpc\nimport api_pb2_grpc as api_grpc\nimport api_pb2 as api_pb\n\nchannel = grpc.insecure_channel('localhost:10000')\nstub = api_grpc.CentrifugoApiStub(channel)\n\ntry:\n    resp = stub.Info(api_pb.InfoRequest())\nexcept grpc.RpcError as err:\n    # GRPC level error.\n    print(err.code(), err.details())\nelse:\n    if resp.error.code:\n        # Centrifugo server level error.\n        print(resp.error.code, resp.error.message)\n    else:\n        print(resp.result)\n")),(0,l.kt)("p",null,"Note that you need to explicitly handle Centrifugo API level error which is not transformed automatically into GRPC protocol-level error."),(0,l.kt)("h3",{id:"grpc-example-for-go"},"GRPC example for Go"),(0,l.kt)("p",null,"Here is a simple example of how to run Centrifugo with the GRPC Go client."),(0,l.kt)("p",null,"You need ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc"),", ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc-gen-go")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc-gen-go-grpc")," installed."),(0,l.kt)("p",null,"First start Centrifugo itself with GRPC API enabled:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"CENTRIFUGO_GRPC_API=1 centrifugo --config config.json\n")),(0,l.kt)("p",null,"In another terminal tab:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"mkdir centrifugo_grpc_example\ncd centrifugo_grpc_example/\ntouch main.go\ngo mod init centrifugo_example\nmkdir apiproto\ncd apiproto\nwget https://raw.githubusercontent.com/centrifugal/centrifugo/master/internal/apiproto/api.proto -O api.proto\n")),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"protoc")," to generate code:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"protoc -I ./ api.proto --go_out=. --go-grpc_out=.\n")),(0,l.kt)("p",null,"Put the following code to ",(0,l.kt)("inlineCode",{parentName:"p"},"main.go")," file (created on the last step above):"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "context"\n    "log"\n    "time"\n\n    "centrifugo_example/apiproto"\n\n    "google.golang.org/grpc"\n)\n\nfunc main() {\n    conn, err := grpc.Dial("localhost:10000", grpc.WithInsecure())\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer conn.Close()\n    client := apiproto.NewCentrifugoApiClient(conn)\n    for {\n        resp, err := client.Publish(context.Background(), &apiproto.PublishRequest{\n            Channel: "chat:index",\n            Data:    []byte(`{"input": "hello from GRPC"}`),\n        })\n        if err != nil {\n            log.Printf("Transport level error: %v", err)\n        } else {\n            if resp.GetError() != nil {\n                respError := resp.GetError()\n                log.Printf("Error %d (%s)", respError.Code, respError.Message)\n            } else {\n                log.Println("Successfully published")\n            }\n        }\n        time.Sleep(time.Second)\n    }\n}\n')),(0,l.kt)("p",null,"Then run:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-bash"},"go run main.go\n")),(0,l.kt)("p",null,"The program starts and periodically publishes the same payload into ",(0,l.kt)("inlineCode",{parentName:"p"},"chat:index")," channel."),(0,l.kt)("h3",{id:"grpc-api-key-authorization"},"GRPC API key authorization"),(0,l.kt)("p",null,"You can also set ",(0,l.kt)("inlineCode",{parentName:"p"},"grpc_api_key")," (string) in Centrifugo configuration to protect GRPC API with key. In this case, you should set per RPC metadata with key ",(0,l.kt)("inlineCode",{parentName:"p"},"authorization")," and value ",(0,l.kt)("inlineCode",{parentName:"p"},"apikey <KEY>"),". For example in Go language:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-go"},'package main\n\nimport (\n    "context"\n    "log"\n    "time"\n\n    "centrifugo_example/apiproto"\n    \n    "google.golang.org/grpc"\n)\n\ntype keyAuth struct {\n    key string\n}\n\nfunc (t keyAuth) GetRequestMetadata(ctx context.Context, uri ...string) (map[string]string, error) {\n    return map[string]string{\n        "authorization": "apikey " + t.key,\n    }, nil\n}\n\nfunc (t keyAuth) RequireTransportSecurity() bool {\n    return false\n}\n\nfunc main() {\n    conn, err := grpc.Dial("localhost:10000", grpc.WithInsecure(), grpc.WithPerRPCCredentials(keyAuth{"xxx"}))\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer conn.Close()\n    client := apiproto.NewCentrifugoClient(conn)\n    for {\n        resp, err := client.Publish(context.Background(), &PublishRequest{\n            Channel: "chat:index",\n            Data:    []byte(`{"input": "hello from GRPC"}`),\n        })\n        if err != nil {\n            log.Printf("Transport level error: %v", err)\n        } else {\n            if resp.GetError() != nil {\n                respError := resp.GetError()\n                log.Printf("Error %d (%s)", respError.Code, respError.Message)\n            } else {\n                log.Println("Successfully published")\n            }\n        }\n        time.Sleep(time.Second)\n    }\n}\n')),(0,l.kt)("p",null,"For other languages refer to GRPC docs."))}d.isMDXComponent=!0}}]);