<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9e615eff0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Centrifugo Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Centrifugo Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-204787498-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Engines, scalability | Centrifugo</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://centrifugal.dev/docs/server/engines"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Engines, scalability | Centrifugo"><meta data-react-helmet="true" name="description" content="The Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve presence and history data."><meta data-react-helmet="true" property="og:description" content="The Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve presence and history data."><meta data-react-helmet="true" property="og:image" content="https://centrifugal.dev/img/centrifugo_soc.png"><meta data-react-helmet="true" name="twitter:image" content="https://centrifugal.dev/img/centrifugo_soc.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://centrifugal.dev/docs/server/engines"><link data-react-helmet="true" rel="alternate" href="https://centrifugal.dev/docs/server/engines" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://centrifugal.dev/docs/server/engines" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3d015319.css">
<link rel="preload" href="/assets/js/runtime~main.eb4c495f.js" as="script">
<link rel="preload" href="/assets/js/main.2a232c10.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><div class="announcementBar_3WsW" role="banner"><div class="announcementBarContent_3EUC announcementBarCloseable_3myR">ðŸ›‘ ðŸ›‘ ðŸ›‘ This is a documentation for Centrifugo v3 which is not released yet. See <a target="_blank" rel="noopener noreferrer" href="https://centrifugal.github.io/centrifugo/">Centrifugo v2 documentation</a> instead. ðŸ›‘ ðŸ›‘ ðŸ›‘</div><button type="button" class="announcementBarClose_38nx clean-btn" aria-label="Close"><span aria-hidden="true">Ã—</span></button></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Centrifugo</b></a><a class="navbar__item navbar__link" href="/docs/getting-started/introduction">Getting Started</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/server/configuration">Server guide</a><a class="navbar__item navbar__link" href="/docs/transports/overview">Transports</a><a class="navbar__item navbar__link" href="/docs/ecosystem/client">Ecosystem</a><a class="navbar__item navbar__link" href="/docs/pro/overview">Centrifugo PRO</a><a class="navbar__item navbar__link" href="/docs/faq/index">FAQ</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/centrifugal/centrifugo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Centrifugo</b></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/server/configuration">Configure Centrifugo</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/console_commands">Console commands</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/server_api">Server API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/authentication">Client authentication</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/channels">Channels</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/private_channels">Private channels</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/server_subs">Server-side subscriptions</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/server/engines">Engines, scalability</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/proxy">Proxy to backend</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/history_and_recovery">History and recovery</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/admin_web">Admin web UI</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/monitoring">Monitoring</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/infra_tuning">Infrastructure tuning</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/load_balancing">Load Balancing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/tls">Configure TLS</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/server/codes">Error and disconnect codes</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Engines, scalability</h1></header><p>The Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve presence and history data.</p><p>By default, Centrifugo uses a Memory engine. There are also Redis, KeyDB, Tarantool engines available. And Nats broker which also supports at most once PUB/SUB.</p><p>The difference between them - with Memory engine you can start only one node of Centrifugo, while Redis engine allows running several nodes on different machines and they all will be connected via PUB/SUB, will know about each other and will also keep history and presence data in Redis instead of Centrifugo node process memory so this data can be accessed from each node and won&#x27;t be lost after Centrifugo server restart.</p><p>To set engine you can use <code>engine</code> configuration option. Available values are <code>memory</code>, <code>redis</code>, <code>tarantool</code>. The default value is <code>memory</code>.</p><p>For example to work with Redis engine:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="memory-engine"></a>Memory engine<a class="hash-link" href="#memory-engine" title="Direct link to heading">#</a></h2><p>Used by default. Supports only one node. Nice choice to start with. Supports all features keeping everything in Centrifugo node process memory. You don&#x27;t need to install Redis when using this engine.</p><p>Advantages:</p><ul><li>Super fast since it does not involve network at all</li><li>Does not require separate broker setup</li></ul><p>Disadvantages:</p><ul><li>Does not allow scaling nodes (actually you still can scale Centrifugo with Memory engine but you have to publish data into each Centrifugo node and you won&#x27;t have consistent history and presence state throughout Centrifugo nodes)</li><li>Does not persist message history in channels between Centrifugo restarts</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="options"></a>Options<a class="hash-link" href="#options" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="history_meta_ttl"></a>history_meta_ttl<a class="hash-link" href="#history_meta_ttl" title="Direct link to heading">#</a></h4><p>Duration, default <code>0s</code>.</p><p><code>history_meta_ttl</code> sets a time in seconds of history stream metadata expiration. Stream metadata is information about the current offset number in the channel and epoch value. By default, metadata for channels does not expire. Though in some cases â€“ when channels are created for Ð° short time and then not used anymore â€“ created metadata can stay in memory while not useful. For example, you can have a personal user channel but after using your app for a while user left it forever. From a long-term perspective, this can be an unwanted memory leak. Setting a reasonable value to this option (usually much bigger than the history retention period) can help. In this case, unused channel metadata will eventually expire.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="redis-engine"></a>Redis engine<a class="hash-link" href="#redis-engine" title="Direct link to heading">#</a></h2><p><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis</a> is an open-source, in-memory data structure store, used as a database, cache, and message broker.</p><p>Centrifugo Redis engine allows scaling Centrifugo nodes to different machines. Nodes will use Redis as a message broker (utilizing Redis PUB/SUB for node communication) and keep presence and history data in Redis.</p><p><strong>Minimal Redis version is 5.0.1</strong></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="options-1"></a>Options<a class="hash-link" href="#options-1" title="Direct link to heading">#</a></h3><p>Several configuration options related to Redis engine:</p><ul><li><code>redis_address</code> (string, default <code>&quot;127.0.0.1:6379&quot;</code>) - Redis server address</li><li><code>redis_password</code> (string, default <code>&quot;&quot;</code>) - Redis password</li><li><code>redis_db</code> (int, default <code>0</code>) - number of Redis db to use</li><li><code>redis_tls</code> (boolean, default <code>false</code>) - enable Redis TLS connection</li><li><code>redis_tls_skip_verify</code> (boolean, default <code>false</code>) - disable Redis TLS host verification</li><li><code>redis_prefix</code> (string, default <code>&quot;centrifugo&quot;</code>) â€“ custom prefix to use for channels and keys in Redis</li><li><code>redis_use_lists</code> (boolean, default <code>false</code>) â€“ turns on using Redis Lists instead of Stream data structure for keeping history (not recommended, keeping this for backwards compatibility mostly).</li></ul><p>Similar to a Memory engine Redis engine also looks at <code>history_meta_ttl</code> option (int, default <code>0</code>) - which sets a time in seconds of history stream metadata expiration in Redis Engine. Meta key in Redis is a HASH that contains the current offset number in channel and epoch value. By default, metadata for channels does not expire. Though in some cases â€“ when channels are created for Ð° short time and then not used anymore â€“ created stream metadata can stay in memory while not useful. For example, you can have a personal user channel but after using your app for a while user left it forever. From a long-term perspective, this can be an unwanted memory leak. Setting a reasonable value to this option (usually much bigger than the history retention period) can help. In this case, unused channel metadata will eventually expire.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="scaling-with-redis-tutorial"></a>Scaling with Redis tutorial<a class="hash-link" href="#scaling-with-redis-tutorial" title="Direct link to heading">#</a></h3><p>Let&#x27;s see how to start several Centrifugo nodes using the Redis Engine. We will start 3 Centrifugo nodes and all those nodes will be connected via Redis.</p><p>First, you should have Redis running. As soon as it&#x27;s running - we can launch 3 Centrifugo instances. Open your terminal and start the first one:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --port=8000 --engine=redis --redis_address=127.0.0.1:6379</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If your Redis is on the same machine and runs on its default port you can omit <code>redis_address</code> option in the command above.</p><p>Then open another terminal and start another Centrifugo instance:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --port=8001 --engine=redis --redis_address=127.0.0.1:6379</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that we use another port number (<code>8001</code>) as port 8000 is already busy by our first Centrifugo instance. If you are starting Centrifugo instances on different machines then you most probably can use
the same port number (<code>8000</code> or whatever you want) for all instances.</p><p>And finally, let&#x27;s start the third instance:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --port=8002 --engine=redis --redis_address=127.0.0.1:6379</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now you have 3 Centrifugo instances running on ports 8000, 8001, 8002 and clients can connect to any of them. You can also send API requests to any of those nodes â€“ as all nodes connected over Redis PUB/SUB message will be delivered to all interested clients on all nodes.</p><p>To load balance clients between nodes you can use Nginx â€“ you can find its configuration here in the documentation.</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>In the production environment you will most probably run Centrifugo nodes on different hosts, so there will be no need to use different <code>port</code> numbers. </p></div></div><p>Here is a live example where we locally start two Centrifugo nodes both connected to local Redis:</p><video width="100%" controls=""><source src="/img/redis_scale_example.mp4" type="video/mp4">Sorry, your browser doesn&#x27;t support embedded video.</video><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redis-sentinel-for-high-availability"></a>Redis Sentinel for high availability<a class="hash-link" href="#redis-sentinel-for-high-availability" title="Direct link to heading">#</a></h3><p>Centrifugo supports the official way to add high availability to Redis - Redis <a href="http://redis.io/topics/sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a>.</p><p>For this you only need to utilize 2 Redis Engine options: <code>redis_sentinel_address</code> and <code>redis_sentinel_master_name</code>:</p><ul><li><code>redis_sentinel_address</code> (string, default <code>&quot;&quot;</code>) - comma separated list of Sentinel addresses for HA. At least one known server required.</li><li><code>redis_sentinel_master_name</code> (string, default <code>&quot;&quot;</code>) - name of Redis master Sentinel monitors</li></ul><p>Also:</p><p><code>redis_sentinel_password</code> â€“ optional string password for your Sentinel, works with Redis Sentinel &gt;= 5.0.1</p><p>So you can start Centrifugo which will use Sentinels to discover Redis master instances like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Where config.json:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_sentinel_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:26379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_sentinel_master_name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;mymaster&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Sentinel configuration files can look like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">port 26379</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentinel monitor mymaster 127.0.0.1 6379 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentinel down-after-milliseconds mymaster 10000</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentinel failover-timeout mymaster 60000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can find how to properly set up Sentinels <a href="http://redis.io/topics/sentinel" target="_blank" rel="noopener noreferrer">in official documentation</a>.</p><p>Note that when your Redis master instance is down there will be a small downtime interval until Sentinels
discover a problem and come to a quorum decision about a new master. The length of this period depends on
Sentinel configuration.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="haproxy-instead-of-sentinel-configuration"></a>Haproxy instead of Sentinel configuration<a class="hash-link" href="#haproxy-instead-of-sentinel-configuration" title="Direct link to heading">#</a></h3><p>Alternatively, you can use Haproxy between Centrifugo and Redis to let it properly balance traffic to Redis master. In this case, you still need to configure Sentinels but you can omit Sentinel specifics from Centrifugo configuration and just use Redis address as in a simple non-HA case.</p><p>For example, you can use something like this in Haproxy config:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">listen redis</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    server redis-01 127.0.0.1:6380 check port 6380 check inter 2s weight 1 inter 2s downinter 5s rise 10 fall 2</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    server redis-02 127.0.0.1:6381 check port 6381 check inter 2s weight 1 inter 2s downinter 5s rise 10 fall 2 backup</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bind *:16379</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mode tcp</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    option tcpka</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    option tcplog</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    option tcp-check</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check send PING\r\n</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check expect string +PONG</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check send info\ replication\r\n</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check expect string role:master</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check send QUIT\r\n</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check expect string +OK</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    balance roundrobin</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And then just point Centrifugo to this Haproxy:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --engine=redis --redis_address=&quot;localhost:16379&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redis-sharding"></a>Redis sharding<a class="hash-link" href="#redis-sharding" title="Direct link to heading">#</a></h3><p>Centrifugo has built-in Redis sharding support.</p><p>This resolves the situation when Redis becoming a bottleneck on a large Centrifugo setup. Redis is a single-threaded server, it&#x27;s very fast but its power is not infinite so when your Redis approaches 100% CPU usage then the sharding feature can help your application to scale.</p><p>At moment Centrifugo supports a simple comma-based approach to configuring Redis shards. Let&#x27;s just look at examples.</p><p>To start Centrifugo with 2 Redis shards on localhost running on port 6379 and port 6380 use config like this:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To start Centrifugo with Redis instances on different hosts:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;192.168.1.34:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;192.168.1.35:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you also need to customize AUTH password, Redis DB number then you can use an extended address notation.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Due to how Redis PUB/SUB works it&#x27;s not possible (and it&#x27;s pretty useless anyway) to run shards in one Redis instance using different Redis DB numbers.</p></div></div><p>When sharding enabled Centrifugo will spread channels and history/presence keys over configured Redis instances using a consistent hashing algorithm. At moment we use Jump consistent hash algorithm (see <a href="https://arxiv.org/pdf/1406.2294.pdf" target="_blank" rel="noopener noreferrer">paper</a> and <a href="https://github.com/dgryski/go-jump" target="_blank" rel="noopener noreferrer">implementation</a>).</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redis-cluster"></a>Redis cluster<a class="hash-link" href="#redis-cluster" title="Direct link to heading">#</a></h3><p>Running Centrifugo with Redis cluster is simple and can be achieved using <code>redis_cluster_address</code> option. This is an array of strings. Each element of the array is a comma-separated Redis cluster seed node. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_cluster_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30001,localhost:30002,localhost:30003&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You don&#x27;t need to list all Redis cluster nodes in config â€“ only several working nodes are enough to start.</p><p>To set the same over environment variable:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CENTRIFUGO_REDIS_CLUSTER_ADDRESS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30001&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CENTRIFUGO_ENGINE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redis ./centrifugo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you need to shard data between several Redis clusters then simply add one more string with seed nodes of another cluster to this array:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_cluster_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30001,localhost:30002,localhost:30003&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30101,localhost:30102,localhost:30103&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Sharding between different Redis clusters can make sense due to the fact how PUB/SUB works in the Redis cluster. It does not scale linearly when adding nodes as all PUB/SUB messages got copied to every cluster node. See <a href="https://github.com/antirez/redis/issues/2672" target="_blank" rel="noopener noreferrer">this discussion</a> for more information on topic. To spread data between different Redis clusters Centrifugo uses the same consistent hashing algorithm described above (i.e. <code>Jump</code>).</p><p>To reproduce the same over environment variable use <code>space</code> to separate different clusters:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CENTRIFUGO_REDIS_CLUSTER_ADDRESS</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30001,localhost:30002 localhost:30101,localhost:30102&quot;</span><span class="token plain"> </span><span class="token assign-left variable" style="color:rgb(191, 199, 213)">CENTRIFUGO_ENGINE</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">redis ./centrifugo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="keydb-engine"></a>KeyDB Engine<a class="hash-link" href="#keydb-engine" title="Direct link to heading">#</a></h2><p><strong>EXPERIMENTAL</strong></p><p>Centrifugo Redis engine seamlessly works with <a href="https://keydb.dev/" target="_blank" rel="noopener noreferrer">KeyDB</a>. KeyDB server is compatible with Redis and provides several additional features beyond. </p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>We can&#x27;t give any promises about compatibility with KeyDB in the future Centrifugo releases - while KeyDB is fully compatible with Redis things should work just fine. That&#x27;s why we consider this as <strong>EXPERIMENTAL</strong> feature.</p></div></div><p>Use KeyDB instead of Redis only if you are sure you need it. Nothing stops you from running several Redis instances per each core you have, configure sharding, and obtain even better performance than KeyDB can provide (due to lack of synchronization between threads in Redis).</p><p>To run Centrifugo with KeyDB all you need to do is use <code>redis</code> engine but run the KeyDB server instead of Redis.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="tarantool-engine"></a>Tarantool engine<a class="hash-link" href="#tarantool-engine" title="Direct link to heading">#</a></h2><p><strong>EXPERIMENTAL</strong></p><p><a href="https://www.tarantool.io" target="_blank" rel="noopener noreferrer">Tarantool</a> is a fast and flexible in-memory storage with different persistence/replication schemes and LuaJIT for writing custom logic on the Tarantool side. It allows implementing Centrifugo engine with unique characteristics.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p><strong>EXPERIMENTAL</strong> status of Tarantool integration means that we are still going to improve it and there could be breaking changes as integration evolves.</p></div></div><p>There are many ways to operate Tarantool in production and it&#x27;s hard to distribute Centrifugo Tarantool engine in a way that suits everyone. Centrifugo tries to fit generic case by providing <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a> module and by providing ready-to-use <a href="https://github.com/centrifugal/rotor" target="_blank" rel="noopener noreferrer">centrifugal/rotor</a> project based on <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a> and <a href="https://github.com/tarantool/cartridge" target="_blank" rel="noopener noreferrer">Tarantool Cartridge</a>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>To be honest we bet on the community help to push this integration further. Tarantool provides an incredible performance boost for presence and history operations (up to 5x more RPS compared to the Redis Engine) and a pretty fast PUB/SUB (comparable to what Redis Engine provides). Let&#x27;s see what we can build together.</p></div></div><p>There are several supported Tarantool topologies to which Centrifugo can connect:</p><ul><li>One standalone Tarantool instance</li><li>Many standalone Tarantool instances and consistently shard data between them</li><li>Tarantool running in Cartridge</li><li>Tarantool with replica and automatic failover in Cartridge</li><li>Many Tarantool instances (or leader-follower setup) in Cartridge with consistent client-side sharding between them</li><li>Tarantool with synchronous replication (Raft-based, Tarantool &gt;= 2.7)</li></ul><p>After running Tarantool you can point Centrifugo to it (and of course scale Centrifugo nodes):</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tarantool&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;tarantool_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:3301&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>See <a href="https://github.com/centrifugal/rotor" target="_blank" rel="noopener noreferrer">centrifugal/rotor</a> repo for ready-to-use engine based on Tarantool Cartridge framework.</p><p>See <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a> repo for examples on how to run engine with Standalone single Tarantool instance or with Raft-based synchronous replication.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="options-2"></a>Options<a class="hash-link" href="#options-2" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="tarantool_address"></a>tarantool_address<a class="hash-link" href="#tarantool_address" title="Direct link to heading">#</a></h4><p>String or array of strings. Default <code>tcp://127.0.0.1:3301</code>.</p><p>Connection address to Tarantool.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="tarantool_mode"></a>tarantool_mode<a class="hash-link" href="#tarantool_mode" title="Direct link to heading">#</a></h4><p>String, default <code>standalone</code></p><p>A mode how to connect to Tarantool. Default is <code>standalone</code> which connects to a single Tarantool instance address. Possible values are: <code>leader-follower</code> (connects to a setup with Tarantool master and async replicas) and <code>leader-follower-raft</code> (connects to a Tarantool with synchronous Raft-based replication).</p><p>All modes support client-side consistent sharding (similar to what Redis engine provides).</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="tarantool_user"></a>tarantool_user<a class="hash-link" href="#tarantool_user" title="Direct link to heading">#</a></h4><p>String, default <code>&quot;&quot;</code>. Allows setting a user.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="tarantool_password"></a>tarantool_password<a class="hash-link" href="#tarantool_password" title="Direct link to heading">#</a></h4><p>String, default <code>&quot;&quot;</code>. Allows setting a password.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="nats-broker"></a>Nats broker<a class="hash-link" href="#nats-broker" title="Direct link to heading">#</a></h2><p>It&#x27;s possible to scale with <a href="https://nats.io/" target="_blank" rel="noopener noreferrer">Nats</a> PUB/SUB server. Keep in mind, that Nats is called a <strong>broker</strong> here, <strong>not an Engine</strong> â€“ Nats integration only implements PUB/SUB part of Engine, so carefully read limitations below.</p><p>Limitations:</p><ul><li>Nats integration works only for unreliable at most once PUB/SUB. This means that history, presence, and message recovery Centrifugo features won&#x27;t be available.</li><li>Nats wildcard channel subscriptions with symbols <code>*</code> and <code>&gt;</code> not supported.</li></ul><p>First start Nats server:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ nats-server</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.324269 [INF] Starting nats-server version 2.1.7</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.324400 [INF] Git commit [not set]</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.325600 [INF] Listening for client connections on 0.0.0.0:4222</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.325612 [INF] Server id is NDAM7GEHUXAKS5SGMA3QE6ZSO4IQUJP6EL3G2E2LJYREVMAMIOBE7JT4</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.325617 [INF] Server is ready</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then start Centrifugo with <code>broker</code> option:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --broker</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">nats --config</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">config.json</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And one more Centrifugo on another port (of course in real life you will start another Centrifugo on another machine):</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --broker</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">nats --config</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">config.json --port</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">8001</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now you can scale connections over Centrifugo instances, instances will be connected over Nats server.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="options-3"></a>Options<a class="hash-link" href="#options-3" title="Direct link to heading">#</a></h3><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="nats_url"></a>nats_url<a class="hash-link" href="#nats_url" title="Direct link to heading">#</a></h4><p>String, default <code>nats://127.0.0.1:4222</code>.</p><p>Connection url in format <code>nats://derek:pass@localhost:4222</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="nats_prefix"></a>nats_prefix<a class="hash-link" href="#nats_prefix" title="Direct link to heading">#</a></h4><p>String, default <code>centrifugo</code>.</p><p>Prefix for channels used by Centrifugo inside Nats.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="nats_dial_timeout"></a>nats_dial_timeout<a class="hash-link" href="#nats_dial_timeout" title="Direct link to heading">#</a></h4><p>Duration, default <code>1s</code>.</p><p>Timeout for dialing with Nats.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="nats_write_timeout"></a>nats_write_timeout<a class="hash-link" href="#nats_write_timeout" title="Direct link to heading">#</a></h4><p>Duration, default <code>1s</code>.</p><p>Write (and flush) timeout for a connection to Nats.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/engines.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/server/server_subs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Server-side subscriptions</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/server/proxy"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Proxy to backend Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#memory-engine" class="table-of-contents__link">Memory engine</a><ul><li><a href="#options" class="table-of-contents__link">Options</a></li></ul></li><li><a href="#redis-engine" class="table-of-contents__link">Redis engine</a><ul><li><a href="#options-1" class="table-of-contents__link">Options</a></li><li><a href="#scaling-with-redis-tutorial" class="table-of-contents__link">Scaling with Redis tutorial</a></li><li><a href="#redis-sentinel-for-high-availability" class="table-of-contents__link">Redis Sentinel for high availability</a></li><li><a href="#haproxy-instead-of-sentinel-configuration" class="table-of-contents__link">Haproxy instead of Sentinel configuration</a></li><li><a href="#redis-sharding" class="table-of-contents__link">Redis sharding</a></li><li><a href="#redis-cluster" class="table-of-contents__link">Redis cluster</a></li></ul></li><li><a href="#keydb-engine" class="table-of-contents__link">KeyDB Engine</a></li><li><a href="#tarantool-engine" class="table-of-contents__link">Tarantool engine</a><ul><li><a href="#options-2" class="table-of-contents__link">Options</a></li></ul></li><li><a href="#nats-broker" class="table-of-contents__link">Nats broker</a><ul><li><a href="#options-3" class="table-of-contents__link">Options</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contacts</div><ul class="footer__items"><li class="footer__item"><a href="mailto:centrifugal.dev@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Send e-mail</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/centrifugal/centrifugo/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/joinchat/U57MI8Lam9mhpuhd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/tYgADKx" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/attributions">Attributions</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Centrifugal.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.eb4c495f.js"></script>
<script src="/assets/js/main.2a232c10.js"></script>
</body>
</html>