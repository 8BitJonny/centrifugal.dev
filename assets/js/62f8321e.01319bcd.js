"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[2314],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return f}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var s=r.createContext({}),l=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=l(e.components);return r.createElement(s.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=c(e,["components","mdxType","originalType","parentName"]),m=l(t),f=o,d=m["".concat(s,".").concat(f)]||m[f]||p[f]||a;return t?r.createElement(d,i(i({ref:n},u),{},{components:t})):r.createElement(d,i({ref:n},u))}));function f(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=m;var c={};for(var s in n)hasOwnProperty.call(n,s)&&(c[s]=n[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var l=2;l<a;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},3452:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return c},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return u},default:function(){return m}});var r=t(2122),o=t(9756),a=(t(7294),t(3905)),i=["components"],c={id:"user_connections",title:"User connections RPC"},s=void 0,l={unversionedId:"pro/user_connections",id:"pro/user_connections",isDocsHomePage:!1,title:"User connections RPC",description:"One more Centrifugo PRO feature is a getUserConnections RPC call. It allows to get all active sessions of the user (by user ID) without turning on presence feature for channels at all. It's also possible to attach any JSON payload to a connection which will be then visible in the result of getUserConnections call. This additional meta information won't be exposed to a client-side.",source:"@site/docs/pro/user_connections.md",sourceDirName:"pro",slug:"/pro/user_connections",permalink:"/docs/pro/user_connections",editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/pro/user_connections.md",version:"current",frontMatter:{id:"user_connections",title:"User connections RPC"},sidebar:"Pro",previous:{title:"Operation throttling",permalink:"/docs/pro/throttling"},next:{title:"PRO performance",permalink:"/docs/pro/performance"}},u=[],p={toc:u};function m(e){var n=e.components,t=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"One more Centrifugo PRO feature is a ",(0,a.kt)("inlineCode",{parentName:"p"},"getUserConnections")," RPC call. It allows to get all active sessions of the user (by user ID) without turning on presence feature for channels at all. It's also possible to attach any JSON payload to a connection which will be then visible in the result of ",(0,a.kt)("inlineCode",{parentName:"p"},"getUserConnections")," call. This additional meta information won't be exposed to a client-side."),(0,a.kt)("p",null,"This feature can be useful to manage active user sessions \u2013 for example in a messenger application. Users can look at a list of current sessions and close some of them (possible with Centrifugo disconnect server API)."),(0,a.kt)("p",null,"Below is a feature showcase using admin web UI, but this call is available over HTTP or GRPC server API."),(0,a.kt)("video",{width:"100%",controls:!0},(0,a.kt)("source",{src:"/img/user_connections.mp4",type:"video/mp4"}),"Sorry, your browser doesn't support embedded video."),(0,a.kt)("p",null,"Let's look at example. Generate a JWT for user 42:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"centrifugo genconfig\ncentrifugo gentoken -u 42\nHMAC SHA-256 JWT for user 42 with expiration TTL 168h0m0s:\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MiIsImV4cCI6MTYyNzcxMzMzNX0.s3eOhujiyBjc4u21nuHkbcWJll4Um0QqGU3PF-6Mf7Y\n")),(0,a.kt)("p",null,"Run Centrifugo with ",(0,a.kt)("inlineCode",{parentName:"p"},"uni_http_stream")," transport enabled (it will allow us to connect from console):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"CENTRIFUGO_UNI_HTTP_STREAM=1 centrifugo -c config.json\n")),(0,a.kt)("p",null,"Create new terminal window and run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST http://localhost:8000/connection/uni_http_stream --data \'{"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MiIsImV4cCI6MTYyNzcxMzMzNX0.s3eOhujiyBjc4u21nuHkbcWJll4Um0QqGU3PF-6Mf7Y", "name": "terminal"}\'\n')),(0,a.kt)("p",null,"In another terminal create one more connection:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'curl -X POST http://localhost:8000/connection/uni_http_stream --data \'{"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI0MiIsImV4cCI6MTYyNzcxMzMzNX0.s3eOhujiyBjc4u21nuHkbcWJll4Um0QqGU3PF-6Mf7Y", "name": "terminal"}\'\n')),(0,a.kt)("p",null,"Then let's call ",(0,a.kt)("inlineCode",{parentName:"p"},"getUserConnections")," using Centrifugo HTTP API RPC extension:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'curl --header "Content-Type: application/json" \\\n  --header "Authorization: apikey <API_KEY>" \\\n  --request POST \\\n  --data \'{"method": "rpc", "params": {"method": "getUserConnections", "params": {"user": "42"}}}\' \\\n  http://localhost:8000/api\n')),(0,a.kt)("p",null,"The result:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "result":{\n        "data":{\n            "0a32d5a2-d898-44fa-b498-bf0bfb064862":{\n                "app_name": "terminal"\n            },\n            "322a7e2f-b3b5-4131-aa0d-3bf343b6a4fe":{\n                "app_name": "terminal"\n            }\n        }\n    }\n}\n')),(0,a.kt)("p",null,"Here we can see that user has 2 connections from ",(0,a.kt)("inlineCode",{parentName:"p"},"terminal")," app."),(0,a.kt)("p",null,"Each connection can be annotated with meta JSON information which is set during connection establishment (over ",(0,a.kt)("inlineCode",{parentName:"p"},"meta")," claim of JWT or by returning ",(0,a.kt)("inlineCode",{parentName:"p"},"meta")," in connect proxy result)."))}m.isMDXComponent=!0}}]);