<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9e615eff0">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Centrifugo Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Centrifugo Blog Atom Feed"><title data-react-helmet="true">Migrating to v3 | Centrifugo</title><meta data-react-helmet="true" property="og:url" content="https://centrifugal.dev/docs/getting-started/migration_v3"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Migrating to v3 | Centrifugo"><meta data-react-helmet="true" name="description" content="This chapter aims to help developers migrate from Centrifugo v2 to Centrifugo v3. Migration should mostly affect backend part only, so you won&#x27;t need to change code of your frontend applications at all. In most cases all you should do is adapt Centrifugo configuration to match v3 changes and redeploy Centrifugo using v3 build instead of v2."><meta data-react-helmet="true" property="og:description" content="This chapter aims to help developers migrate from Centrifugo v2 to Centrifugo v3. Migration should mostly affect backend part only, so you won&#x27;t need to change code of your frontend applications at all. In most cases all you should do is adapt Centrifugo configuration to match v3 changes and redeploy Centrifugo using v3 build instead of v2."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://centrifugal.dev/docs/getting-started/migration_v3"><link data-react-helmet="true" rel="alternate" href="https://centrifugal.dev/docs/getting-started/migration_v3" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://centrifugal.dev/docs/getting-started/migration_v3" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.cb410a33.css">
<link rel="preload" href="/assets/js/runtime~main.09a1f061.js" as="script">
<link rel="preload" href="/assets/js/main.043dee4f.js" as="script">
</head>
<body>
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,e("light"))}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top navbarHideable_2qcr"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Centrifugo</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/getting-started/introduction">Getting Started</a><a class="navbar__item navbar__link" href="/docs/server/configuration">Server guide</a><a class="navbar__item navbar__link" href="/docs/transports/overview">Transports</a><a class="navbar__item navbar__link" href="/docs/ecosystem/client">Ecosystem</a><a class="navbar__item navbar__link" href="/docs/pro/overview">Centrifugo PRO</a><a class="navbar__item navbar__link" href="/docs/faq/index">FAQ</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/centrifugal/centrifugo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="navbar__search searchBarContainer_MM2z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_s5VG searchBarLoadingRing_2jQk"><div></div><div></div><div></div><div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button" title="Scroll to top"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo sidebarWithHideableNavbar_267A"><a tabindex="-1" class="sidebarLogo_3h0W" href="/"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedImage_1VuW themedImage--dark_hz6m"><b>Centrifugo</b></a><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/introduction">Centrifugo introduction</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/highlights">Main highlights</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/installation">Install Centrifugo</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/quick_start">Quick start</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/client_api">Client API showcase</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/integration">Integration guide</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/getting-started/design">Design overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/getting-started/migration_v3">Migrating to v3</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1 class="h1Heading_27L5">Migrating to v3</h1></header><p>This chapter aims to help developers migrate from Centrifugo v2 to Centrifugo v3. Migration should mostly affect backend part only, so you won&#x27;t need to change code of your frontend applications at all. In most cases all you should do is adapt Centrifugo configuration to match v3 changes and redeploy Centrifugo using v3 build instead of v2.</p><p>There are a couple of exceptions - read carefully about client-side changes below.</p><p>In any case â€“ don&#x27;t forget to test your application before running in production.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="client-side-changes"></a>Client-side changes<a class="hash-link" href="#client-side-changes" title="Direct link to heading">#</a></h2><p>Client protocol has some backwards incompatible changes regarding working with history API and removing deprecated fields.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="no-unlimited-history-by-default"></a>No unlimited history by default<a class="hash-link" href="#no-unlimited-history-by-default" title="Direct link to heading">#</a></h3><p>Call to <code>history</code> API from client-side now does not return all publications from history cache. It returns only information about stream with zero publications. Clients should explicitly provide a limit when calling history API. Also the maximum allowed limit can be set by <code>client_history_max_publication_limit</code> option (by default <code>300</code>).</p><p>We provide a boolean flag <code>use_unlimited_history_by_default</code> to enable previous behaviour while you migrate client applications to use explicit limit.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="publication-limit-for-recovery"></a>Publication limit for recovery<a class="hash-link" href="#publication-limit-for-recovery" title="Direct link to heading">#</a></h3><p>Maximum number of messages that can be recovered is now limited by <code>client_recovery_max_publication_limit</code> option which is by default <code>300</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="seqgen-fields-removed"></a>Seq/Gen fields removed<a class="hash-link" href="#seqgen-fields-removed" title="Direct link to heading">#</a></h3><p>Deprecated seq/gen now removed and Centrifugo uses <code>offset</code> field for position in a stream. This means that there is no need in <code>v3_use_offset</code> option anymore â€“ it&#x27;s not used in Centrifugo v3.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="server-side-changes"></a>Server-side changes<a class="hash-link" href="#server-side-changes" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="time-interval-options-are-duration"></a>Time interval options are duration<a class="hash-link" href="#time-interval-options-are-duration" title="Direct link to heading">#</a></h3><p>In Centrifugo v3 all time intervals should be configured using <a href="/docs/server/configuration#setting-time-duration-options">duration</a>.</p><p>For example <code>&quot;proxy_connect_timeout&quot;: 1</code> should be changed to <code>&quot;proxy_connect_timeout&quot;: &quot;1s&quot;</code>.</p><p>We provide a <a href="#v2-to-v3-config-converter">configuration converter</a> which takes this change into account.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="channel-options-changes"></a>Channel options changes<a class="hash-link" href="#channel-options-changes" title="Direct link to heading">#</a></h3><p>In Centrifugo v3 <code>history_recover</code> option becomes <code>recover</code>.</p><p>Also <code>history_lifetime</code> renamed to <code>history_ttl</code> and it&#x27;s now a <a href="/docs/server/configuration#setting-time-duration-options">duration</a>.</p><p>We provide a <a href="#v2-to-v3-config-converter">configuration converter</a> which takes this change into account.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="some-command-line-flags-removed"></a>Some command-line flags removed<a class="hash-link" href="#some-command-line-flags-removed" title="Direct link to heading">#</a></h3><p>Configuring over command-line flags is not very convenient for production deployments, Centrifugo v3 reduced a number of command-line flags available â€“ it mostly has flags frequently useful for development now. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="enforced-request-origin-check"></a>Enforced request Origin check<a class="hash-link" href="#enforced-request-origin-check" title="Direct link to heading">#</a></h3><p>In Centrifugo v3 you should explicitly <a href="/docs/server/configuration#allowed_origins">set a list of allowed origins</a> which are allowed to connect to client transport endpoints.</p><p>There is a way to disable origin check, but it&#x27;s discouraged and insecure in case you are using connect proxy feature:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;allowed_origins&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="updated-grpc-api-protobuf-package"></a>Updated GRPC API Protobuf package<a class="hash-link" href="#updated-grpc-api-protobuf-package" title="Direct link to heading">#</a></h3><p>In Centrifugo v3 we addressed an <a href="https://github.com/centrifugal/centrifugo/issues/379" target="_blank" rel="noopener noreferrer">issue</a> where package name in Protobuf definitions resulted into some inconvenience and attempts to rename it. But it&#x27;s not possible to rename since GRPC uses it as part of RPC methods internally. Now GRPC API package looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">package centrifugal.centrifugo.api;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This means you need to regenerate your GRPC code which communicates with Centrifugo using latest Protobuf definitions. Refer to the <a href="/docs/server/server_api#grpc-api">GRPC API doc</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="channels-api-method-removed"></a>Channels API method removed<a class="hash-link" href="#channels-api-method-removed" title="Direct link to heading">#</a></h3><p>Channels API method removed in Centrifugo v3. But it&#x27;s still possible to extract information about channels using new RPC extension with method called <code>getChannels</code>. New extension has new additional possibilities like showing the number of connections in a channel and filter channels by pattern but it still has the same caveat as before: this method does not scale well for many active channels in a system.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="http-proxy-changes"></a>HTTP proxy changes<a class="hash-link" href="#http-proxy-changes" title="Direct link to heading">#</a></h3><p>When using HTTP proxy you should now set an explicit list of headers you want to proxy. To mimic behaviour of Centrifugo v2 add to your configuration:</p><div class="codeBlockContainer_K1bP"><div style="color:#bfc7d5;background-color:#292d3e" class="codeBlockTitle_eoMF">config.json</div><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;proxy_http_headers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Origin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;User-Agent&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Cookie&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Authorization&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;X-Real-Ip&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;X-Forwarded-For&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;X-Request-Id&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you had a list of extra HTTP headers using <code>proxy_extra_http_headers</code> then additionally extend list above with values from <code>proxy_extra_http_headers</code>. Then you can remove <code>proxy_extra_http_headers</code> - it&#x27;s not used anymore.</p><p>Another important change is how Centrifugo proxies binary data over HTTP JSON proxy. Previously proxy mode (whether to use base64 fields fields or not) could be configured using <code>encoding=binary</code> URL param of connection. With Centrifugo v3 it&#x27;s only possible to use binary mode by enabling <code>&quot;proxy_binary_encoding&quot;: true</code> option. BTW according to our community poll only 2% of Centrifugo users used binary mode in HTTP proxy. If you have problems with new behaviour â€“ write about your situation to our community chats â€“ and we will see what&#x27;s possible.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="jwt-changes"></a>JWT changes<a class="hash-link" href="#jwt-changes" title="Direct link to heading">#</a></h3><p><code>eto</code> claim of subscription JWT removed. But since Centrifugo v3 introduced an additional <code>expire_at</code> claim it&#x27;s still possible to implement one-time subscription tokens without enabling subscription expiration workflow by setting <code>&quot;expire_at: 0&quot;</code> in subscription JWT claims.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redis-configuration-changes"></a>Redis configuration changes<a class="hash-link" href="#redis-configuration-changes" title="Direct link to heading">#</a></h3><p>Redis configuration was a bit messy - especially in Redis sharding case, in v3 we decided to clean up it a bit. Make it more explicit and reduce number of possible ways to configure.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="redis-streams-used-by-default"></a>Redis streams used by default<a class="hash-link" href="#redis-streams-used-by-default" title="Direct link to heading">#</a></h3><p>Centrifugo v3 will use Redis Stream data structure to keep history instead of lists. This requires Redis &gt;= 5 to work.</p><p>If you still need List data structure or have an old Redis version you can use <code>&quot;redis_use_lists&quot;: true</code> to mimic default behaviour of Centrifugo v2.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="sockjs-disabled-by-default"></a>SockJS disabled by default<a class="hash-link" href="#sockjs-disabled-by-default" title="Direct link to heading">#</a></h3><p>Our poll showed that most Centrifugo users do not use SockJS transport. In v3 it&#x27;s disabled by default. You can enable it by setting <code>&quot;sockjs&quot;: true</code> in configuration.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="other-configuration-changes"></a>Other configuration changes<a class="hash-link" href="#other-configuration-changes" title="Direct link to heading">#</a></h3><p>Here is a full list of configuration option changes. We provide a best-effort <a href="#v2-to-v3-config-converter">configuration converter</a>.</p><p><code>allowed_origins</code> is now required</p><p><code>v3_use_offset</code> removed</p><p><code>redis_streams</code> removed</p><p><code>tls_autocert_force_rsa</code> removed</p><p><code>redis_pubsub_num_workers</code> removed</p><p><code>sockjs_disable</code> removed</p><p><code>secret</code> renamed to <code>token_hmac_secret_key</code></p><p><code>history_lifetime</code> renamed to <code>history_ttl</code></p><p><code>history_recover</code> renamed to <code>recover</code></p><p><code>client_presence_ping_interval</code> renamed to <code>client_presence_update_interval</code></p><p><code>client_ping_interval</code> renamed to <code>websocket_ping_interval</code></p><p><code>client_message_write_timeout</code> renamed to <code>websocket_write_timeout</code></p><p><code>client_request_max_size</code> renamed to <code>websocket_message_size_limit</code></p><p><code>client_presence_expire_interval</code> renamed to <code>presence_ttl</code></p><p><code>memory_history_meta_ttl</code> renamed to <code>history_meta_ttl</code></p><p><code>redis_history_meta_ttl</code> renamed to <code>history_meta_ttl</code></p><p><code>redis_sequence_ttl</code> renamed to <code>history_meta_ttl</code></p><p><code>redis_presence_ttl</code> renamed to <code>presence_ttl</code></p><p><code>presence_ttl</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>websocket_write_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>websocket_ping_interval</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>client_presence_update_interval</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>history_ttl</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>history_meta_ttl</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>nats_dial_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>nats_write_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>graphite_interval</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>shutdown_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>shutdown_termination_delay</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>proxy_connect_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>proxy_refresh_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>proxy_rpc_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>proxy_subscribe_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>proxy_publish_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>client_expired_close_delay</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>client_expired_sub_close_delay</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>client_stale_close_delay</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>client_channel_position_check_delay</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>node_info_metrics_aggregate_interval</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>websocket_ping_interval</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>websocket_write_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>sockjs_heartbeat_delay</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>redis_idle_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>redis_connect_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>redis_read_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>redis_write_timeout</code> should be converted to <a href="/docs/server/configuration#setting-time-duration-options">duration</a></p><p><code>redis_cluster_addrs</code> renamed to <code>redis_cluster_address</code></p><p><code>redis_sentinels</code> renamed to <code>redis_sentinel_address</code></p><p><code>redis_master_name</code> renamed to <code>redis_sentinel_master_name</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="v2-to-v3-config-converter"></a>v2 to v3 config converter<a class="hash-link" href="#v2-to-v3-config-converter" title="Direct link to heading">#</a></h3><p>Here is a converter between Centrifugo v2 and v3 JSON configuration. It can help to translate most of things automatically for you.</p><p>If you are using Centrifugo with TOML format then you can use <a href="https://pseitz.github.io/toml-to-json-online-converter/" target="_blank" rel="noopener noreferrer">online converter</a> as initial step. Or <a href="https://jsonformatter.org/yaml-to-json" target="_blank" rel="noopener noreferrer">yaml-to-json</a> and <a href="https://jsonformatter.org/json-to-yaml" target="_blank" rel="noopener noreferrer">json-to-yaml</a> for YAML.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>It&#x27;s fully client-side: your data won&#x27;t be sent anywhere.</p></div></div><div class="admonition admonition-danger alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</h5></div><div class="admonition-content"><p>Unfortunately we can&#x27;t migrate environment variables and command-line flags authomatically - so if you are using env vars or command-line flags to configure Centrifugo you still need to migrate manually. Also, be aware: this converter tool is best effort only â€“ we can not guarantee it solves all corner cases, especially in Redis configuration â€“ you may still need to fix some things manually.</p></div></div><div><textarea placeholder="Paste your Centrifugo v2 JSON config here..." style="width:100%;height:300px;border:2px solid #ccc"></textarea><button>Convert</button><pre style="margin-top:10px">Here will be configuration for v3</pre><pre style="margin-top:10px">Here will be log of changes made in your config</pre></div></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/centrifugal/centrifugal.dev/edit/main/docs/getting-started/migration-v3.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/getting-started/design"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Design overview</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#client-side-changes" class="table-of-contents__link">Client-side changes</a><ul><li><a href="#no-unlimited-history-by-default" class="table-of-contents__link">No unlimited history by default</a></li><li><a href="#publication-limit-for-recovery" class="table-of-contents__link">Publication limit for recovery</a></li><li><a href="#seqgen-fields-removed" class="table-of-contents__link">Seq/Gen fields removed</a></li></ul></li><li><a href="#server-side-changes" class="table-of-contents__link">Server-side changes</a><ul><li><a href="#time-interval-options-are-duration" class="table-of-contents__link">Time interval options are duration</a></li><li><a href="#channel-options-changes" class="table-of-contents__link">Channel options changes</a></li><li><a href="#some-command-line-flags-removed" class="table-of-contents__link">Some command-line flags removed</a></li><li><a href="#enforced-request-origin-check" class="table-of-contents__link">Enforced request Origin check</a></li><li><a href="#updated-grpc-api-protobuf-package" class="table-of-contents__link">Updated GRPC API Protobuf package</a></li><li><a href="#channels-api-method-removed" class="table-of-contents__link">Channels API method removed</a></li><li><a href="#http-proxy-changes" class="table-of-contents__link">HTTP proxy changes</a></li><li><a href="#jwt-changes" class="table-of-contents__link">JWT changes</a></li><li><a href="#redis-configuration-changes" class="table-of-contents__link">Redis configuration changes</a></li><li><a href="#redis-streams-used-by-default" class="table-of-contents__link">Redis streams used by default</a></li><li><a href="#sockjs-disabled-by-default" class="table-of-contents__link">SockJS disabled by default</a></li><li><a href="#other-configuration-changes" class="table-of-contents__link">Other configuration changes</a></li><li><a href="#v2-to-v3-config-converter" class="table-of-contents__link">v2 to v3 config converter</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contacts</div><ul class="footer__items"><li class="footer__item"><a href="mailto:centrifugal.dev@gmail.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Send e-mail</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/centrifugal/centrifugo/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://t.me/joinchat/U57MI8Lam9mhpuhd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://discord.gg/tYgADKx" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/attributions">Attributions</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Centrifugal.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.09a1f061.js"></script>
<script src="/assets/js/main.043dee4f.js"></script>
</body>
</html>